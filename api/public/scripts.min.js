!function(){"use strict";angular.module("ThaiHome",["angularMoment","underscore","ngRoute","ngMap","ngMaterial","ngAnimate","ui.router","ui.bootstrap","ngTouch","duScroll","ngResource","templates-main","dpd","datatables","xeditable","ui-notification","routeStyles","angularFileUpload","credit-cards","ui.sortable","multiStepForm","textAngular","ENV","vcRecaptcha","ngclipboard"]).value("dpdConfig",{collections:["discount","booking","users","language","translation","news"],serverRoot:"/api/",socketOptions:{reconnectionDelayMax:3e3},noCache:!1}).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","NotificationProvider",function(a,b,c,d,e){c.defaults.withCredentials=!0,e.setOptions({delay:5e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"}),d.html5Mode(!0),b.otherwise("/"),b.rule(function(a,b){var c=b.url();if(!("/"===c[c.length-1]||c.indexOf("/?")>-1))return c.indexOf("?")>-1?c.replace("?","/?"):c+"/"})}]).run(["$rootScope","Locale","$state","Auth","$q","editableOptions","editableThemes","$timeout","CONFIG",function(a,b,c,d,e,f,g,h,i){f.theme="bs3",g.bs3.inputClass="input",g.bs3.buttonsClass="btn-primary",d.checkLogged(),b.init(),a.$on("$stateChangeSuccess",function(a,b,c,d,e){"management"===b.name.split(".")[0]&&localStorage.setItem("currency",i.DEFAULT_CURRENCY),document.body.scrollTop=document.documentElement.scrollTop=0,h(function(){}),$(".page-loading").addClass("hide"),h(function(){window.prerenderReady=!0},3e3)}),a.$on("$stateChangeStart",function(a,b,c,d,e){b.resolve&&(-1!=b.url.indexOf("/voucher-print")?$(".page-loading").addClass("hide"):$(".page-loading").removeClass("hide"))}),a.$on("$stateChangeError",function(a,b,d,e,f,g){$(".page-loading").addClass("hide"),c.go("home")})}]).filter("currency",["$rootScope",function(a){return function(b,c,d,e){return c+" "+(parseInt(b)*(e?e:a.currencyRate)).toFixed(0)}}]).filter("defaultDateFormat",["CONFIG",function(a){return function(b){return moment.unix(b).format(a.DEFAULT_DATE_FORMAT)}}]).filter("defaultFullDateFormat",["CONFIG",function(a){return function(b){return moment.unix(b).format(a.DEFAULT_FULL_DATE_FORMAT)}}]).filter("shortDateFormat",["CONFIG",function(a){return function(b){return moment.unix(b).format(a.SHORT_DATE_FORMAT)}}]).filter("currencyConv",function(){return function(a,b){return b+" "+a.toFixed(0).replace(".00","").replace(".",",")}}).filter("timeAgo",function(){return function(a){return moment.duration(moment(a,"x")-moment().unix(),"s").humanize(!0)}}).filter("monthName",function(){return function(a){return moment.monthsShort()[parseInt(a)-1]}}).filter("timeFormat",function(){return function(a){var b=[],c=moment.duration(a,"days").format("Y,M,W,D"),d=c.split(",");d=d.reverse(),d[3]>0&&b.push(d[3]+" "+(d[3]>1?"years":"year")),d[2]>0&&b.push(d[2]+" "+(d[2]>1?"months":"month")),d[1]>0&&b.push(d[1]+" "+(d[1]>1?"weeks":"week")),d[0]>0&&b.push(d[0]+" "+(d[0]>1?"nights":"night"));var e=b.join(", ");return e}}).filter("nl2br",function(a){return function(b,c){var c=c||!0,d=c?"<br />":"<br>",b=(b+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+d+"$2");return a.trustAsHtml(b)}}).filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}).directive("ngReallyClick",[function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){var b=c.ngReallyMessage;b&&confirm(b)&&a.$apply(c.ngReallyClick)})}}}]).directive("imageonload",function(){return{restrict:"A",link:function(a,b){b.bind("load",function(){console.log(1),b.removeClass("spinner-hide"),b.addClass("spinner-show"),b.parent().find("span").remove()}),a.$watch("ngSrc",function(){console.log(123),b.addClass("spinner-hide")})}}})}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.bookings",{url:"bookings/",css:"/css/admin.css",controller:"BookingsCtrl",templateProvider:function(a){return a.get("templates/admin/bookings/index.html")},resolve:{Bookings:["Booking","$q","$rootScope",function(a,b,c){var d=b.defer();return a.find().then(function(a){c.menu_bookings=a.data.length,d.resolve(a.data)})["catch"](function(){c.menu_bookings=0,d.resolve([])}),d.promise}],BookingData:[function(){return{}}]}}).state("admin.bookings.view",{url:"view/:id/",css:"/css/admin.css",controller:"BookingsCtrl",templateProvider:function(a){return a.get("templates/admin/bookings/view.html")},resolve:{BookingData:["Booking","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}})}]).controller("BookingsCtrl",["$scope","$state","$rootScope","Modal","Calendar","$timeout","$http","CONFIG","Notification","Property","Locale","Booking","BookingData","Bookings","DTOptionsBuilder","vcRecaptchaService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a,b){for(var c in b)b.hasOwnProperty(c)&&(b[c]=a)}function r(b){for(var c in b)if(b.hasOwnProperty(c)&&!b[c])return void(a.selectAll=!1);a.selectAll=!0}a.dtOptions=o.newOptions().withOption("bStateSave",!0),m.data?(a.data=m.data,a.data.priceExtra=a.data.priceExtra||[]):a.data={property:{}},a.publicKey=h.PUBLIC_KEY,a.selected={},a.selectAll=!1,a.disabled=!0,a.toggleAll=q,a.toggleOne=r,angular.forEach(n,function(b){a.selected[b.id]=!1}),a.verifyCallback=function(b){a.disabled=!1},a.expiredCallback=function(b){a.disabled=!0},a.deleteSelected=function(c){if(""===p.getResponse())alert("Please resolve the captcha and delete!");else if(c){$(".page-loading").removeClass("hide");var d={Event:"DELETE",Type:"All",Collection:"booking"};l.deleteAll(d).then(function(){i.success({message:"All Bookings Deleted !"}),b.go("admin.bookings",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?(i.error({message:JSON.stringify(a.data.errors)}),$(".page-loading").addClass("hide")):(i.error({message:JSON.stringify(a.data)}),$(".page-loading").addClass("hide"))})}else{var e=[];if($(".page-loading").removeClass("hide"),angular.forEach(a.selected,function(a,b){1==a&&e.push(b)}),e.length>0){var d={Event:"DELETE",Type:"Selected",ids:e,Collection:"booking"};l.deleteAll(d).then(function(){i.success({message:"Selected Bookings Deleted !"}),b.go("admin.bookings",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?(i.error({message:JSON.stringify(a.data.errors)}),$(".page-loading").addClass("hide")):(i.error({message:JSON.stringify(a.data)}),$(".page-loading").addClass("hide"))})}else alert("Please select booking for delete!"),$(".page-loading").addClass("hide")}},a.bookings=n,a.bookingType="0",a.getStatus=function(a){return l.getStatus(a)},a.data.checkin=moment.unix(a.data.checkin).format(h.DEFAULT_DATE_FORMAT),a.data.checkout=moment.unix(a.data.checkout).format(h.DEFAULT_DATE_FORMAT),j.getDetails(a.data.property.unique).then(function(b){a.fullPrice=b.data.price,e.loadCalendar(!1,!1,!1,b.data.bookings)}),a.options={calendarOpened:!0},a.addExtra=function(){a.data.priceExtra.push({name:"Add a name",price:0})},a.removeExtra=function(b){a.data.priceExtra.splice(b,1),a.calcExtra()},a.calcExtra=function(){var b=0;_.each(a.data.priceExtra,function(a){b+=parseInt(a.price)}),a.priceExtraCalc=b},a.calcExtra(),a.agentList=function(){d.agentList()},a.tenantList=function(){d.tenantList()},a.discountList=function(){d.discountList()},a.statusList=function(){d.statusList(l.getStatus(null,!0))},a.propertyList=function(){d.propertyList(a.data.checkin,a.data.checkout)},a.openCalendar=function(){return a.data.property.id?(a.options.calendarOpened=!0,void f(function(){$(".arrival").data("dateRangePicker").open()})):i.error({message:"Please select a property first"})},a.emailList=function(){d.emailList(a.data.id,a.data.emails)},c.$on("propertySelected",function(b,c){k.deleteDates(),i.info({message:"Please reselect booking dates"}),a.data.property.id&&e.destroy(),j.getDetails(c.unique).then(function(b){a.fullPrice=b.data.price,e.loadCalendar(!1,!1,!1,b.data.bookings)}),f(function(){a.data.property=c,a.data.checkin=!1,a.data.checkout=!1})}),c.$on("agentSelected",function(b,c){a.data.agent=c}),c.$on("tenantSelected",function(b,c){a.data.user=c}),c.$on("discountSelected",function(b,c){a.data.discount=c}),c.$on("statusSelected",function(b,c){a.data.status=c.value}),c.$on("datesChanged",function(b,c){a.options.calendarOpened&&f(function(){a.data.checkin=c.checkin,a.data.checkout=c.checkout,g.get(h.API_URL+"/getprice",{params:{property:a.data.property.id,checkin:c.checkin,checkout:c.checkout,format:h.DEFAULT_DATE_FORMAT}}).success(function(b){a.data.priceDay=b.price,a.data.nights=b.nights,b.nights<7?a.data.agentCommission=a.fullPrice.commissionDay:b.nights<30?a.data.agentCommission=a.fullPrice.commissionWeek:b.nights<365?a.data.agentCommission=a.fullPrice.commissionMonth:a.data.agentCommission=a.fullPrice.commissionYear})})}),a.getStatus=function(a){return l.getStatus(a)},a["delete"]=function(a){l["delete"](a).then(function(){i.success({message:"Booking Deleted !"}),b.go("management.home",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?i.error({message:JSON.stringify(a.data.errors)}):i.error({message:JSON.stringify(a.data)})})},a.update=function(){var d={property:a.data.property.id,user:a.data.user.id,agent:a.data.agent.id?a.data.agent.id:"",agentCommission:a.data.agentCommission,discount:a.data.discount.id,discountPercentage:a.data.discount.percent,checkin:a.data.checkin?moment(a.data.checkin,h.DEFAULT_DATE_FORMAT).unix():"",checkout:a.data.checkout?moment(a.data.checkout,h.DEFAULT_DATE_FORMAT).unix():"",status:a.data.status,currency:a.data.currency,priceExtra:a.data.priceExtra,paymentType:a.data.paymentType,priceDay:a.data.priceDay,created:moment().unix(),utilitiesElectricity:a.data.utilitiesElectricity,utilitiesWater:a.data.utilitiesWater,utilitiesWifi:a.data.utilitiesWifi,utilitiesCable:a.data.utilitiesCable,rate:c.currencyRate,cleanfinalprice:a.data.property.cleanfinalprice,cleanprice:a.data.property.cleanprice,expires:a.data.expires,nights:a.data.nights,conditionsAgent:a.data.conditionsAgent,conditionsTenant:a.data.conditionsTenant,pricePaid:a.data.pricePaid,priceReservation:a.data.priceReservation,emails:a.data.emails};l.update(a.data.id,d).then(function(){i.success({message:"Booking Updated !"}),b.go("admin.bookings",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?i.error({message:JSON.stringify(a.data.errors)}):i.error({message:JSON.stringify(a.data)})})},f(function(){$(".inittable").click()},500),a.back=function(){b.go("admin.bookings")}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.currencies",{url:"currencies/",css:"/css/admin.css",controller:"CurrenciesCtrl",templateProvider:function(a){return a.get("templates/admin/currencies/index.html")},resolve:{Currencies:["Currency","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],CurrencyData:[function(){return!1}]}}).state("admin.currencies.view",{url:"view/:id/",css:"/css/admin.css",controller:"CurrenciesCtrl",templateProvider:function(a){return a.get("templates/admin/currencies/view.html")},resolve:{CurrencyData:["Currency","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.currencies.add",{url:"add/",css:"/css/admin.css",controller:"CurrenciesCtrl",templateProvider:function(a){return a.get("templates/admin/currencies/view.html")},resolve:{CurrencyData:[function(){return!1}]}})}]).controller("CurrenciesCtrl",["Currency","$stateParams","$scope","$state","Currencies","CurrencyData","DTOptionsBuilder","Notification","$timeout",function(a,b,c,d,e,f,g,h,i){c.dtOptions=g.newOptions(),c.currencies=e,f?c.currency=f:c.currency={active:!1,"default":!1},i(function(){$(".inittable").click()},500),c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Currency Deleted"}),c.currencies=_.without(c.currencies,_.findWhere(c.currencies,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){a.add(c.currency).then(function(){h.success({message:"Currency Modified"}),d.go("admin.currencies",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.back=function(){d.go("admin.currencies",{},{reload:!0})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.deals",{url:"deals/",css:"/css/admin.css",controller:"DealsCtrl",templateProvider:function(a){return a.get("templates/admin/deals/index.html")},resolve:{Deals:["HotDeals","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],DealData:[function(){return!1}]}}).state("admin.deals.view",{url:"view/:id/",css:"/css/admin.css",controller:"DealsCtrl",templateProvider:function(a){return a.get("templates/admin/deals/view.html")},resolve:{DealData:["HotDeals","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.deals.add",{url:"add/",css:"/css/admin.css",controller:"DealsCtrl",templateProvider:function(a){return a.get("templates/admin/deals/view.html")},resolve:{DealData:[function(){return!1}]}})}]).controller("DealsCtrl",["HotDeals","$stateParams","$scope","$state","Deals","DealData","DTOptionsBuilder","Notification","Calendar","$timeout","$rootScope","Modal","CONFIG",function(a,b,c,d,e,f,g,h,i,j,k,l,m){c.dtOptions=g.newOptions(),c.deals=e,f?c.deal=f:c.deal={active:!1,hot:!1,start:moment().unix(),end:moment().unix(),priceDay:0,priceWeek:0,priceMonth:0,priceYear:0},c.loadCalendar=function(){i.doubleDates(".dealCalendar","periodChanged",moment.unix(c.deal.start).format(m.DEFAULT_DATE_FORMAT),moment.unix(c.deal.end).format(m.DEFAULT_DATE_FORMAT))},k.$on("periodChanged",function(a,b){j(function(){c.deal.start=b.date1,c.deal.end=b.date2})}),c.propertyList=function(){l.propertyList()},k.$on("propertySelected",function(a,b){c.deal.property=b}),c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Deal Deleted"}),c.deals=_.without(c.deals,_.findWhere(c.deals,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){c.deal.property=c.deal.property.id,c.deal.start=moment(c.deal.start,m.DEFAULT_DATE_FORMAT).unix(),c.deal.end=moment(c.deal.end,m.DEFAULT_DATE_FORMAT).unix(),a.add(c.deal).then(function(){h.success({message:"Deal Modified"}),d.go("admin.deals",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.discounts",{url:"discounts/",css:"/css/admin.css",controller:"DiscountsCtrl",templateProvider:function(a){return a.get("templates/admin/discounts/index.html")},resolve:{Discounts:["Discount","$q",function(a,b){var c=b.defer();return a.getAll({details:!0}).then(function(a){c.resolve(a)}),c.promise}],DiscountData:[function(){return!1}]}}).state("admin.discounts.view",{url:"view/:id/",css:"/css/admin.css",controller:"DiscountsCtrl",templateProvider:function(a){return a.get("templates/admin/discounts/view.html")},resolve:{Discounts:[function(){return!1}],DiscountData:["Discount","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.discounts.add",{url:"add/",css:"/css/admin.css",controller:"DiscountsCtrl",templateProvider:function(a){return a.get("templates/admin/discounts/view.html")},resolve:{DiscountData:[function(){return!1}]}})}]).controller("DiscountsCtrl",["Discount","$stateParams","$scope","$state","Discounts","DiscountData","DTOptionsBuilder","Notification","Modal","$rootScope","CONFIG","Calendar","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m){c.dtOptions=g.newOptions().withOption("bStateSave",!0),c.discounts=e,f?c.discount=f:c.discount={},c.loadCalendarExpire=function(){l.singleDate(".discountexpires","expireChanged",c.discount.expires)},j.$on("expireChanged",function(a,b){m(function(){c.discount.expires=b})}),c.propertyList=function(){i.propertyList()},j.$on("propertySelected",function(a,b){c.discount.property=b}),c.tenantList=function(){i.tenantList()},j.$on("tenantSelected",function(a,b){c.discount.user=b}),c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Discount Deleted"}),c.discounts=_.without(c.discounts,_.findWhere(c.discounts,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){c.discount.property=c.discount.property.id,c.discount.user=c.discount.user.id,a.add(c.discount).then(function(){h.success({message:"Discounts Modified"}),d.go("admin.discounts",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},m(function(){$(".inittable").click()},500),c.back=function(){d.go("admin.discounts")}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.emails",{url:"emails/",css:"/css/admin.css",controller:"EmailsCtrl",templateProvider:function(a){return a.get("templates/admin/emails/index.html")},resolve:{Emails:["Email","$q",function(a,b){var c=b.defer();return a.list().then(function(a){c.resolve(a)}),c.promise}],EmailData:function(){return{}}}}).state("admin.emails.view",{url:"view/:id/",css:"/css/admin.css",controller:"EmailsCtrl",templateProvider:function(a){return a.get("templates/admin/emails/view.html")},resolve:{Emails:function(){return[]},EmailData:["$http","$q","$stateParams","CONFIG",function(a,b,c,d){var e=b.defer();return a.get(d.API_URL+"/emails/",{params:{value:c.id}}).then(function(a){e.resolve(a.data[0])})["catch"](function(){e.reject()}),e.promise}]}}).state("admin.emails.add",{url:"add/",css:"/css/admin.css",controller:"EmailsCtrl",templateProvider:function(a){return a.get("templates/admin/emails/view.html")},resolve:{Emails:function(){return[]},EmailData:function(){return{}}}}).state("admin.emails.signature",{url:"signature/",css:"/css/admin.css",controller:"EmailsCtrl",templateProvider:function(a){return a.get("templates/admin/emails/signature.html")},resolve:{Emails:function(){return[]},EmailData:["$http","$q","$stateParams","CONFIG",function(a,b,c,d){var e=b.defer();return a.get(d.API_URL+"/emails/",{params:{value:"signature"}}).then(function(a){e.resolve(a.data[0])})["catch"](function(){e.reject()}),e.promise}]}})}]).controller("EmailsCtrl",["Emails","$stateParams","$scope","$state","Email","EmailData","DTOptionsBuilder","Notification","Modal","$rootScope","CONFIG","Calendar","$timeout","$http",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){c.dtOptions=g.newOptions().withOption("bStateSave",!0),c.emails=a,c.email=f,c.viewTags=function(){i.tags()},c["delete"]=function(a){n["delete"](k.API_URL+"/emails/"+a).then(function(){h.success({message:"Email Deleted"}),c.emails=_.without(c.emails,_.findWhere(c.emails,{id:a}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){var a=c.email;n.post(k.API_URL+"/emails",a).then(function(){h.success({message:"Email Modified"}),d.go("admin.emails",{},{reload:!0})})["catch"](function(a){if(a.data&&a.data.errors){var b="";_.mapObject(a.data.errors,function(a,c){b+='<p class="format_error"><b>'+c+"</b> - "+a+"</p>"}),h.error({message:b})}else h.error({message:JSON.stringify(a.data)})})},c._signature="",void 0!=c.email&&void 0!=c.email.value&&"signature"==c.email.value&&(c._signature=c.email.html),c.changeSignature=function(){if(void 0==c.email){var a={name:"Default Signature",value:"signature",html:c._signature};n.post(k.API_URL+"/emails",a).then(function(){h.success({message:"Signature Modified!"}),d.go("admin.emails.signature",{},{reload:!0})})["catch"](function(a){if(a.data&&a.data.errors){var b="";_.mapObject(a.data.errors,function(a,c){b+='<p class="format_error"><b>'+c+"</b> - "+a+"</p>"}),h.error({message:b})}else h.error({message:JSON.stringify(a.data)})})}else{var a={html:c._signature};n.post(k.API_URL+"/emails/"+c.email.id,a).then(function(){h.success({message:"Signature Modified!"}),d.go("admin.emails.signature",{},{reload:!0})})["catch"](function(a){if(a.data&&a.data.errors){var b="";_.mapObject(a.data.errors,function(a,c){b+='<p class="format_error"><b>'+c+"</b> - "+a+"</p>"}),h.error({message:b})}else h.error({message:JSON.stringify(a.data)})})}},m(function(){$(".inittable").click()},500),c.back=function(){d.go("admin.emails",{},{reload:!0})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin",{url:"/admin/",templateProvider:function(a){return a.get("templates/admin/home/index.html")},controller:["$state","$rootScope",function(a,b){if("admin"===a.current.name){if("admin"===b.admin.type)return a.go("admin.home");"translator"===b.admin.type&&a.go("admin.site-translations")}$(function(){$("#side-menu").metisMenu(),$(window).bind("load resize",function(){topOffset=50,width=this.window.innerWidth>0?this.window.innerWidth:this.screen.width,width<768?($("div.navbar-collapse").addClass("collapse"),topOffset=100):$("div.navbar-collapse").removeClass("collapse"),height=(this.window.innerHeight>0?this.window.innerHeight:this.screen.height)-1,height-=topOffset,height<1&&(height=1),height>topOffset&&$("#page-wrapper").css("min-height",height+"px")});var a=window.location,b=$("ul.nav a").filter(function(){return this.href==a||0==a.href.indexOf(this.href)}).addClass("active").parent().parent().addClass("in").parent();b.is("li")&&b.addClass("active")})}],resolve:{Admin:["Auth","$q","$state","$rootScope",function(a,b,c,d){var e=b.defer();return a.checkLogged().then(function(a){"admin"===a.data.type?(d.admin=a.data,e.resolve(a)):"translator"===a.data.type?(d.admin=a.data,e.resolve(a)):(c.go("admin_login"),e.reject())})["catch"](function(){c.go("admin_login"),e.reject()}),e.promise}]}}).state("admin.home",{url:"home/",css:"/css/admin.css",controller:"AdminHomeCtrl",title:"title_admin_home",template:""})}]).controller("AdminHomeCtrl",[function(){}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.languages",{url:"languages/",css:"/css/admin.css",controller:"LanguagesCtrl",templateProvider:function(a){return a.get("templates/admin/languages/index.html")},resolve:{Languages:["Language","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],LanguageData:[function(){return!1}]}}).state("admin.languages.view",{url:"view/:id/",css:"/css/admin.css",controller:"LanguagesCtrl",templateProvider:function(a){return a.get("templates/admin/languages/view.html")},resolve:{LanguageData:["Language","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.languages.add",{url:"add/",css:"/css/admin.css",controller:"LanguagesCtrl",templateProvider:function(a){return a.get("templates/admin/languages/view.html")},resolve:{LanguageData:[function(){return!1}]}})}]).controller("LanguagesCtrl",["Language","$stateParams","$scope","$state","Languages","LanguageData","DTOptionsBuilder","Notification","$timeout",function(a,b,c,d,e,f,g,h,i){c.dtOptions=g.newOptions(),c.languages=e,f?c.language=f:c.language={active:!1,"default":!1},c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Language Deleted"}),c.languages=_.without(c.languages,_.findWhere(c.languages,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){a.add(c.language).then(function(){h.success({message:"Language Modified"}),d.go("admin.languages",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},i(function(){$(".inittable").click()},500),c.back=function(){d.go("admin.languages")}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.locations",{url:"locations/",css:"/css/admin.css",controller:"LocationsCtrl",templateProvider:function(a){return a.get("templates/admin/locations/index.html")},resolve:{Locations:["Location","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],LocationData:[function(){return!1}]}}).state("admin.locations.view",{url:"view/:id/",css:"/css/admin.css",controller:"LocationsCtrl",templateProvider:function(a){return a.get("templates/admin/locations/view.html")},resolve:{LocationData:["Location","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.locations.add",{url:"add/",css:"/css/admin.css",controller:"LocationsCtrl",templateProvider:function(a){return a.get("templates/admin/locations/view.html")},resolve:{LocationData:[function(){return!1}]}})}]).controller("LocationsCtrl",["Location","$stateParams","$scope","$state","Locations","LocationData","DTOptionsBuilder","Notification","$timeout",function(a,b,c,d,e,f,g,h,i){c.dtOptions=g.newOptions(),c.locations=e,f?c.location=f:c.location={},c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Location Deleted"}),c.locations=_.without(c.locations,_.findWhere(c.locations,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){a.add(c.location).then(function(){h.success({message:"Location Modified"}),d.go("admin.locations",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},i(function(){$(".inittable").click()},500),c.back=function(){d.go("admin.locations",{},{reload:!0})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin_login",{controller:"AdminLoginCtrl",url:"/admin/login/",title:"title_admin_login",css:"/css/style.css",templateProvider:function(a){return a.get("templates/admin/login/index.html")},resolve:{Admin:["Auth","$q","$state",function(a,b,c){var d=b.defer();return a.checkLogged().then(function(a){"admin"===a.data.type?(c.go("admin.home"),d.resolve(a)):"translator"===a.data.type?(c.go("admin.site-translations"),d.resolve(a)):d.resolve()})["catch"](function(){d.reject()}),d.promise}]}}).state("admin_logout",{url:"/admin/logout/",resolve:{Logout:["Auth","$q","$state",function(a,b,c){var d=b.defer();return a.logout().then(function(){c.go("admin_login",{},{reload:!0}),d.resolve()})["catch"](function(){c.go("admin_login",{},{reload:!0}),d.resolve()}),d.promise}]}})}]).controller("AdminLoginCtrl",["$scope","$stateParams","Auth","$state",function(a,b,c,d){a.to="management",a.login=function(b,e,f){a.$error=!1,c.loginAdmin(b,e).then(function(a){return"translator"===a.type?d.go("admin.site-translations"):void d.go(f+".home")})["catch"](function(){a.$error=!0})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.messages",{url:"messages/",css:"/css/admin.css",controller:"MessagesCtrl",templateProvider:function(a){return a.get("templates/admin/messages/index.html")},resolve:{Messages:["Contact","$q",function(a,b){var c=b.defer();return a.getAllMessages().then(function(a){c.resolve(a)}),c.promise}]}})}]).controller("MessagesCtrl",["$scope","$state","$rootScope","Modal","Calendar","$timeout","$http","CONFIG","Notification","Property","Locale","Messages","DTOptionsBuilder","vcRecaptchaService","Contact",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b){for(var c in b)b.hasOwnProperty(c)&&(b[c]=a)}function q(b){for(var c in b)if(b.hasOwnProperty(c)&&!b[c])return void(a.selectAll=!1);a.selectAll=!0}a.dtOptions=m.newOptions().withOption("bStateSave",!0),a.messages=l,a.publicKey=h.PUBLIC_KEY,a.selected={},a.selectAll=!1,a.disabled=!0,a.toggleAll=p,a.toggleOne=q,angular.forEach(l,function(b){a.selected[b.id]=!1}),a.verifyCallback=function(b){a.disabled=!1},a.expiredCallback=function(b){a.disabled=!0},a.deleteSelected=function(c){if(""===n.getResponse())alert("Please resolve the captcha and delete message!");else if(c){$(".page-loading").removeClass("hide");var d={Event:"DELETE",Type:"All",Collection:"message"};o.deleteAllMessage(d).then(function(){i.success({message:"All Messages Deleted !"}),b.go("admin.messages",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?(i.error({message:JSON.stringify(a.data.errors)}),$(".page-loading").addClass("hide")):(i.error({message:JSON.stringify(a.data)}),$(".page-loading").addClass("hide"))})}else{var e=[];if($(".page-loading").removeClass("hide"),angular.forEach(a.selected,function(a,b){1==a&&e.push(b)}),e.length>0){var d={Event:"DELETE",Type:"Selected",ids:e,Collection:"message"};o.deleteAllMessage(d).then(function(){i.success({message:"Selected Messages Deleted !"}),b.go("admin.messages",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?(i.error({message:JSON.stringify(a.data.errors)}),$(".page-loading").addClass("hide")):(i.error({message:JSON.stringify(a.data)}),$(".page-loading").addClass("hide"))})}else alert("Please select message for delete!"),$(".page-loading").addClass("hide")}},a.messages=l,a["delete"]=function(a){o["delete"](a).then(function(){i.success({message:"Message Deleted !"}),b.go("admin.messages",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?i.error({message:JSON.stringify(a.data.errors)}):i.error({message:JSON.stringify(a.data)})})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.news",{url:"news/",css:"/css/admin.css",controller:"NewsICtrl",templateProvider:function(a){return a.get("templates/admin/news/index.html")},resolve:{AllNews:["News","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],NewsData:[function(){return!1}]}}).state("admin.news.view",{url:"view/:id/",css:"/css/admin.css",controller:"NewsICtrl",templateProvider:function(a){return a.get("templates/admin/news/view.html")},resolve:{NewsData:["News","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.news.add",{url:"add/",css:"/css/admin.css",controller:"NewsICtrl",templateProvider:function(a){return a.get("templates/admin/news/view.html")},resolve:{NewsData:[function(){return!1}]}})}]).controller("NewsICtrl",["News","AllNews","$stateParams","$scope","$state","NewsData","Notification","Calendar","$rootScope","$timeout","DTOptionsBuilder",function(a,b,c,d,e,f,g,h,i,j,k){d.dtOptions=k.newOptions(),d.allNews=b,f?d["new"]=f:d["new"]={},d.loadCalendar=function(){h.doubleDates(".periodPeriod","periodChanged2",d["new"].start,d["new"].end,"X")},i.$on("periodChanged2",function(a,b){j(function(){d["new"].start=b.date1,d["new"].end=b.date2})}),d["delete"]=function(b){a["delete"](b).then(function(){g.success({message:"News Deleted"}),d.news=_.without(d.news,_.findWhere(d.news,{id:b}))})["catch"](function(a){a.data&&a.data.errors?g.error({message:JSON.stringify(a.data.errors)}):g.error({message:JSON.stringify(a.data)})})},d.update=function(){
a.add(d["new"]).then(function(){g.success({message:"News Modified"}),e.go("admin.news",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?g.error({message:JSON.stringify(a.data.errors)}):g.error({message:JSON.stringify(a.data)})})},j(function(){$(".inittable").click()},500),d.back=function(){e.go("admin.news")}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.periods",{url:"periods/",css:"/css/admin.css",controller:"PeriodsCtrl",templateProvider:function(a){return a.get("templates/admin/periods/index.html")},resolve:{Periods:["Period","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],PeriodData:[function(){return!1}]}}).state("admin.periods.view",{url:"view/:id/",css:"/css/admin.css",controller:"PeriodsCtrl",templateProvider:function(a){return a.get("templates/admin/periods/view.html")},resolve:{PeriodData:["Period","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.periods.add",{url:"add/",css:"/css/admin.css",controller:"PeriodsCtrl",templateProvider:function(a){return a.get("templates/admin/periods/view.html")},resolve:{PeriodData:[function(){return!1}]}})}]).controller("PeriodsCtrl",["Period","$stateParams","$scope","$state","Periods","PeriodData","DTOptionsBuilder","Notification","Calendar","$rootScope","$timeout","Modal",function(a,b,c,d,e,f,g,h,i,j,k,l){c.dtOptions=g.newOptions().withOption("bStateSave",!0),c.periods=e,f?c.period=f:c.period={},c.loadCalendar=function(){i.doubleDates(".periodPeriod","periodChanged",c.period.from,c.period.to,"D-M")},j.$on("periodChanged",function(a,b){k(function(){c.period.from=b.date1,c.period.to=b.date2})}),c.seasonList=function(){l.seasonList()},j.$on("seasonSelected",function(a,b){c.period.season=b}),c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Period Deleted"}),c.periods=_.without(c.periods,_.findWhere(c.periods,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){a.add(c.period).then(function(){h.success({message:"Period Modified"}),d.go("admin.periods",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},k(function(){$(".inittable").click()},500),c.back=function(){d.go("admin.periods")}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.prices",{url:"prices/",css:"/css/admin.css",controller:"PricesCtrl",templateProvider:function(a){return a.get("templates/admin/prices/index.html")},resolve:{Prices:["Price","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],PriceData:[function(){return!1}]}}).state("admin.prices.view",{url:"view/:id/",css:"/css/admin.css",controller:"PricesCtrl",templateProvider:function(a){return a.get("templates/admin/prices/view.html")},resolve:{PriceData:["Price","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.prices.add",{url:"prices/add/",css:"/css/admin.css",controller:"PricesCtrl",templateProvider:function(a){return a.get("templates/admin/prices/view.html")},resolve:{PriceData:[function(){return!1}]}})}]).controller("PricesCtrl",["Price","$stateParams","$scope","$state","Prices","PriceData","DTOptionsBuilder","Notification","Modal","$rootScope","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){c.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},c.dtOptions=g.newOptions().withOption("bStateSave",!0),c.prices=e,f?c.price=f:c.price={priceDay:0,priceWeek:0,priceMonth:0,priceYear:0,commissionDay:0,commissionWeek:0,commissionMonth:0,commissionYear:0,depositDay:0,depositWeek:0,depositMonth:0,depositYear:0,priceWeekend:0},c.startWatch=function(){setTimeout(function(){$('form[name="editableForm"]').find("input.editable-input").keyup(function(){var a=$(this).prop("name"),b=this.value;c.$apply(function(){c.price[a]=b})})},500)},c.stopWatch=function(){$('form[name="editableForm"]').find("input.editable-input").unbind()},c.propertyList=function(){i.propertyList()},j.$on("propertySelected",function(a,b){c.price.property=b}),c.seasonList=function(){i.seasonList()},j.$on("seasonSelected",function(a,b){c.price.season=b}),c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Price Deleted"}),c.prices=_.without(c.prices,_.findWhere(c.prices,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){c.price.property=c.price.property.id,c.price.created||(c.price.created=moment().unix()),a.add(c.price).then(function(){h.success({message:"Price Modified"}),d.go("admin.prices")})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},k(function(){$(".inittable").click()},500),c.back=function(){d.go("admin.prices")}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.properties",{url:"properties/",css:"/css/admin.css",controller:"PropertiesCtrl",templateProvider:function(a){return a.get("templates/admin/properties/index.html")},resolve:{Properties:["Property","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],PropertyData:[function(){return!1}]}}).state("admin.properties.view",{url:"view/:id/",css:"/css/admin.css",controller:"PropertiesCtrl",templateProvider:function(a){return a.get("templates/admin/properties/view.html")},resolve:{PropertyData:["Property","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.properties.add",{url:"properties/add/",css:"/css/admin.css",controller:"PropertiesCtrl",templateProvider:function(a){return a.get("templates/admin/properties/view.html")},resolve:{PropertyData:[function(){return!1}]}})}]).controller("PropertiesCtrl",["Property","$stateParams","$scope","$state","Properties","PropertyData","DTOptionsBuilder","Notification","FileUploader","CONFIG","Modal","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l){c.dtOptions=g.newOptions().withOption("bStateSave",!0),c.dtOptions.iDisplayStart=20,c.properties=e,f?(c.property=f.data.property,c.imagesList=c.property.images):c.property={active:!1,location:{}},c.updateImageOrder=function(){c.property.images=c.imagesList,c.update(!0)};var m=c.uploader=new i({url:j.API_URL+"/propertyimage",queueLimit:1,formData:[{unique:c.property.unique,id:c.property.id}]});m.onBeforeUploadItem=function(a){h.success({message:a._file.name+" is uploading..."})},m.filters.push({removeAfterUpload:!1,name:"imageFilter",fn:function(a,b){var c="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|".indexOf(c)}}),m.onSuccessItem=function(a,b,d,e){b&&b.success&&b.filename&&(c.property.images.push(b.filename),m.removeFromQueue(a),h.success({message:"Upload Completed!"}))},c.deleteImg=function(a){c.property.images=_.without(c.property.images,a)},c.featuredImg=function(a){c.property.featured=a},c.locationList=function(){k.locationList()},l.$on("locationSelected",function(a,b){c.property.location=b}),c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Property Deleted"}),c.properties=_.without(c.properties,_.findWhere(c.properties,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(b){a.add(c.property).then(function(){h.success({message:"Property Modified"}),b||d.go("admin.properties",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})}}]).directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.ratings",{url:"ratings/",css:"/css/admin.css",controller:"RatingsCtrl",templateProvider:function(a){return a.get("templates/admin/ratings/index.html")},resolve:{Ratings:["Rating","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],RatingData:[function(){return!1}]}}).state("admin.ratings.view",{url:"view/:id/",css:"/css/admin.css",controller:"RatingsCtrl",templateProvider:function(a){return a.get("templates/admin/ratings/view.html")},resolve:{RatingData:["Rating","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}})}]).controller("RatingsCtrl",["Rating","$stateParams","$scope","$state","Ratings","RatingData","DTOptionsBuilder","Notification","Modal","$rootScope","Calendar","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){c.dtOptions=g.newOptions().withOption("bStateSave",!0),c.ratings=e,f?c.rating=f:c.rating={ratings:[3,3,3],active:!1},c.loadCalendarDate=function(){k.singleDate(".ratingdate","dateChanged",c.rating.date)},j.$on("dateChanged",function(a,b){l(function(){c.rating.date=b})}),c["delete"]=function(b){a["delete"](b).then(function(){h.success({message:"Rating Deleted"}),c.ratings=_.without(c.ratings,_.findWhere(c.ratings,{id:b}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},c.update=function(){c.rating.avgRating=Math.round((parseInt(c.rating.ratings[0])+parseInt(c.rating.ratings[1])+parseInt(c.rating.ratings[2]))/3*2)/2,a.add(c.rating).then(function(){h.success({message:"Rating Modified"}),d.go("admin.ratings",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},l(function(){$(".inittable").click()},500),c.back=function(){d.go("admin.ratings")}}])}(),function(){"use strict";angular.module("ThaiHome").directive("adminSidebar",["$templateCache",function(a){return{restrict:"AE",controller:"AdminSidebarCtrl",template:function(){return a.get("templates/admin/sidebar/index.html")}}}]).directive("adminHeader",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/admin/header/index.html")}}}]).controller("AdminSidebarCtrl",["$scope","$rootScope",function(a,b){var c=[{name:"Dashboard",icon:"fa-dashboard",sref:"admin.home",childs:[]},{name:"Users",icon:"fa-user-md",sref:"admin.users",childs:[]},{name:"News",icon:"fa-file-o",sref:"admin.news",childs:[]},{name:"Emails",icon:"fa-envelope-o",sref:"admin.emails",childs:[]},{name:"Messages",icon:"fa-weixin",sref:"admin.messages",childs:[]},{name:"Languages",icon:"fa-flag",sref:"admin.languages",childs:[]},{name:"Bookings",icon:"fa-euro",sref:"admin.bookings",childs:[]},{name:"Currencies",icon:"fa-euro",sref:"admin.currencies",childs:[]},{name:"Discounts",icon:"fa-tag",sref:"admin.discounts",childs:[]},{name:"Deals",icon:"fa-money",sref:"admin.deals",childs:[]},{name:"Translations",icon:"fa-flag",sref:".",childs:[{name:"Translations",icon:"fa-flag",sref:"admin.site-translations"},{name:"Properties",icon:"fa-flag",sref:"admin.property-translations"}]},{name:"Properties",icon:"fa-building",sref:"admin.properties",childs:[{name:"List",icon:"fa-building",sref:"admin.properties"},{name:"Add",icon:"fa-building",sref:"admin.properties.add"},{name:"Prices",icon:"fa-building",sref:"admin.prices"},{name:"Ratings",icon:"fa-star",sref:"admin.ratings"},{name:"Locations",icon:"fa-location-arrow",sref:"admin.locations"}]},{name:"Periods",icon:"fa-calendar",sref:"admin.periods",childs:[]}];"translator"===b.admin.type&&(c=[{name:"Translations",icon:"fa-flag",sref:".",childs:[{name:"Translations",icon:"fa-flag",sref:"admin.site-translations"},{name:"Properties",icon:"fa-flag",sref:"admin.property-translations"}]}]),a.items=c}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.site-translations",{url:"translations/",css:"/css/admin.css",controller:"TranslationsCtrl",templateProvider:function(a){return a.get("templates/admin/translations/index.html")},resolve:{Translations:["Language","$q","Auth",function(a,b,c){var d=b.defer(),e={};return c.checkLogged().then(function(b){"translator"===b.data.type&&(e.shortname={$in:b.data.languages}),a.getAll(e).then(function(a){d.resolve(a)})}),d.promise}],TranslationData:function(){return!1},TranslationDef:function(){return!1}}}).state("admin.site-translations.edit",{url:"edit/:shortname/",css:"/css/admin.css",controller:"TranslationsCtrl",templateProvider:function(a){return a.get("templates/admin/translations/view.html")},resolve:{TranslationData:["$q","$http","$stateParams",function(a,b,c){var d=a.defer();return b.get("/translations/"+c.shortname+".json").then(function(a){d.resolve(a.data)})["catch"](function(){d.reject()}),d.promise}],TranslationDef:["$q","$http","$stateParams","CONFIG",function(a,b,c,d){var e=a.defer();return b.get("/translations/"+d.DEFAULT_LANGUAGE+".json").then(function(a){e.resolve(a.data)})["catch"](function(){e.reject()}),e.promise}]}}).state("admin.property-translations",{url:"translations/property/",css:"/css/admin.css",controller:"PropertyTranslationsCtrl",templateProvider:function(a){return a.get("templates/admin/translations/property-index.html")},resolve:{Translations:["Translation","$q","Auth",function(a,b,c){var d=b.defer(),e={};return c.checkLogged().then(function(b){"translator"===b.data.type&&(e.language={$in:b.data.languages}),a.getAll(e).then(function(a){d.resolve(a)})}),d.promise}],TranslationData:function(){return!1}}}).state("admin.property-translations.edit",{url:"edit/:id/",css:"/css/admin.css",controller:"PropertyTranslationsCtrl",templateProvider:function(a){return a.get("templates/admin/translations/property-view.html")},resolve:{TranslationData:["$q","Translation","$stateParams",function(a,b,c){var d=a.defer();return b.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}],Translations:function(){return!1}}}).state("admin.property-translations.add",{url:"add/",css:"/css/admin.css",controller:"PropertyTranslationsCtrl",templateProvider:function(a){return a.get("templates/admin/translations/property-view.html")},resolve:{TranslationData:[function(){return!1}],Translations:function(){return!1}}})}]).controller("TranslationsCtrl",["Translations","TranslationData","TranslationDef","$stateParams","$scope","$state","DTOptionsBuilder","$http","Notification","CONFIG",function(a,b,c,d,e,f,g,h,i,j){e.dtOptions=g.newOptions().withOption("bStateSave",!0),e.languages=a,e.translationOriginal=b,e["default"]=function(){e.translationDefault=c},e.translationSearch="",e.translation=_.pairs(b),e.pagination={number:e.translation.length,current:1,perPage:10},e.translationKeys=_.keys(c).sort(),e.transData=e.translationKeys.slice(0,e.pagination.perPage),e.search=function(a){e.searchResult=b[a],e.searchKey=a},e.transValues={},_.each(b,function(a,b){e.transValues[b]=a}),e.updateText=function(a){e.translationOriginal[a]=e.transValues[a];var b={data:e.translationOriginal,shortname:d.shortname};h.post(j.API_URL+"/save-translation",b).then(function(){i.success({message:"Translation Updated"})})},e.pageChanged=function(){e.transData=e.translationKeys.slice((e.pagination.current-1)*e.pagination.perPage,(e.pagination.current-1)*e.pagination.perPage+e.pagination.perPage)}}]).controller("PropertyTranslationsCtrl",["Translations","TranslationData","Translation","$stateParams","$scope","$state","DTOptionsBuilder","Notification","Modal","$rootScope","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){e.dtOptions=g.newOptions(),e.translations=a,b?e.translation=b:e.translation={property:{},amenities:[{}],texts:[{}]},"translator"===j.admin.type&&(e.languages=j.admin.languages),e.propertyList=function(){i.propertyList()},j.$on("propertySelected",function(a,b){e.translation.property=b}),e["delete"]=function(a){c["delete"](a).then(function(){h.success({message:"Translation Deleted"}),e.translations=_.without(e.translations,_.findWhere(e.translations,{id:a}))})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},e.update=function(){_.keys(e.translation.property).length&&(e.translation.property=e.translation.property.id),c.add(e.translation).then(function(){h.success({message:"Translation Modified"}),f.go("admin.property-translations",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?h.error({message:JSON.stringify(a.data.errors)}):h.error({message:JSON.stringify(a.data)})})},k(function(){$(".inittable").click()},500),e.back=function(){f.go("admin.property-translations")}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("admin.users",{url:"users/",css:"/css/admin.css",controller:"UsersCtrl",templateProvider:function(a){return a.get("templates/admin/users/index.html")},resolve:{Users:["User","$q",function(a,b){var c=b.defer();return a.getAll().then(function(a){c.resolve(a)}),c.promise}],UserData:[function(){return!1}]}}).state("admin.users.view",{url:"view/:id/",css:"/css/admin.css",controller:"UsersCtrl",templateProvider:function(a){return a.get("templates/admin/users/view.html")},resolve:{UserData:["User","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}]}}).state("admin.users.add",{url:"add/",css:"/css/admin.css",controller:"UsersCtrl",templateProvider:function(a){return a.get("templates/admin/users/view.html")},resolve:{UserData:[function(){return!1}]}})}]).controller("UsersCtrl",["User","$stateParams","$scope","$state","Users","UserData","DTOptionsBuilder","$rootScope","Countries","Notification","Modal","Booking","$timeout","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){c.userTypes=a.userTypes(),c.dtOptions=g.newOptions().withOption("bStateSave",!0),c.users=e,f?(f.languages||(f.languages=[]),c.user=f,c.user.lastContact=n("defaultFullDateFormat")(c.user.lastContact),c.user.created=n("defaultFullDateFormat")(c.user.created)):c.user={lastContact:moment().unix(),created:moment().unix(),languages:[]},m(function(){$(".adduser").click()},500),c.bookingList=function(a){l.find({user:a}).then(function(a){var b=_.map(a.data,function(a){return a.status=l.getStatus(a.status),a});k.bookingList(b)})},c.languages=h.languages,c.countries=i.list,c["delete"]=function(b){a["delete"](b).then(function(){j.success({message:"User Deleted"}),c.users=_.without(c.users,_.findWhere(c.users,{id:b}))})["catch"](function(a){a.data&&a.data.errors?j.error({message:JSON.stringify(a.data.errors)}):j.error({message:JSON.stringify(a.data)})})},c.showLanguages=function(){var a=[];return angular.forEach(c.languages,function(b){c.user.languages.indexOf(b.shortname)>=0&&a.push(b.name)}),a.length?a.join(", "):"-"},c.update=function(){a.add(c.user).then(function(){j.success({message:"User Modified"}),d.go("admin.users",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?j.error({message:JSON.stringify(a.data.errors)}):j.error({message:JSON.stringify(a.data)})})},c.back=function(){d.go("admin.users",{},{reload:!0})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent.book",{url:"book/:id/:discount/",title:"title_book",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/book/index.html")},controller:"AgentBookCtrl",resolve:{check:["Booking","Locale","$q","$stateParams",function(a,b,c,d){var e=c.defer();return a.check(d.id,!0).then(function(a){a?e.reject():e.resolve()}),e.promise}],Dates:["$q","Locale",function(a,b){var c=a.defer(),d=b.getDates();return d.valid||(b.setDefaultDates(!0),d=b.getDates()),d.valid?c.resolve(d):c.reject(),c.promise}],PropertyData:["Property","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}],Message:["Contact","$q","Auth",function(a,b,c){var d=b.defer();return c.checkLogged().then(function(b){a.getMessage(null,b.data.id,null).then(function(a){d.resolve(a)})["catch"](function(){d.resolve({data:[]})})}),d.promise}]}})}]).controller("AgentBookCtrl",["PropertyData","Message","Booking","Email","Calendar","Contact","Modal","gMaps","$scope","CONFIG","$rootScope","$http","Discount","Locale","$stateParams","Payment","$compile","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){i.paymentMethods=p.methods(),i.selectPayment=function(a){i.paymentType=parseInt(a);var b=_.findWhere(i.paymentMethods,{id:parseInt(a)});if(b.cc)$("#payment_placeholder").html("");else{var c=b.directive,d=q(c)(i);$("#payment_placeholder").html(d)}},i.contact={name:k.agent.name,email:k.agent.email},_.isEmpty(b)?i.messages={}:(i.messages=b,r(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight)},1e3)),i.askQuestion=function(){f.askQuestion(i.contact,!1,i.property.id).then(function(a){i.messages=a,g.messageReceived(),i.contact.message=""})},i.getDay=function(a){return f.getDay(a)},e.loadCalendar(),i.data={},i.property=a.data.property,i.price=a.data.price,i.discount={percent:0},i.applyDiscount=function(){return i.discount_code?void m.getDiscount(i.discount_code,null,i.property.id).then(function(a){a.length?i.discount=a[0]:(i.discount={percent:0},i.discount_code="Invalid")}):(i.invalidDiscount="Invalid",!1)},o.discount?m.getDiscount(o.discount,null,i.property.id).then(function(a){a.length?(i.discount=a[0],i.discount_code=o.discount):i.discount={percent:0}}):i.discount={percent:0},i.ownership=function(){g.ownership()},i.period=function(){return n.period(i.nights)},k.$on("datesChanged",function(a,b){i.checkin=b.checkin,i.checkout=b.checkout,l.get(j.API_URL+"/getprice",{params:{property:i.property.id,checkin:b.checkin,checkout:b.checkout,format:j.DEFAULT_DATE_FORMAT}}).success(function(a){i.priceDay=a.price,i.nights=a.nights;var b;b=i.nights<7?"commissionDay":i.nights<30?"commissionWeek":i.nights<365?"commissionMonth":"commissionYear",i.agentCommission=i.price[b]}),i.showPrices=!0}),i.book=function(){var a={property:i.property.id,user:{email:i.tenant.email,name:i.tenant.name,country:i.contact.country,phone:i.contact.phone,agent:k.agent.id},agent:k.agent.id,agentCommission:i.agentCommission,discount:i.discount.id,discountPercentage:i.discount.percent,checkin:moment.utc(i.checkin,j.DEFAULT_DATE_FORMAT).startOf("day").unix(),checkout:moment.utc(i.checkout,j.DEFAULT_DATE_FORMAT).startOf("day").unix(),status:0,currency:_.findWhere(k.currencies,{currency:localStorage.getItem("currency")}).id,paymentType:i.paymentType,priceDay:i.priceDay,created:moment().utc().unix(),utilitiesElectricity:i.nights>6?"Paid by tenant at Check-out":"Paid by us",utilitiesWater:i.nights>6?"Paid by tenant at Check-out":"Paid by us",utilitiesWifi:"Included",utilitiesCable:"Included BTV",rate:k.currencyRate,cleanfinalprice:i.property.cleanfinalprice,cleanprice:i.property.cleanprice,expires:moment().utc().add(j.BOOKING_DAYS_EXPIRE,"day").unix(),nights:i.nights,pricePaid:0,emails:[]};c.newBooking(a).then(function(a){var b={booking:a.data.id,subject:"Your booking on "+i.property.unique,language:k.language};d.send("booking_confirmation",b),g.newBookingAgent(i.tenant.email,a.data.id)})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent.booking",{url:"booking/:id/",title:"title_book",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/booking/index.html")},controller:"AgentBookingCtrl",resolve:{BookingData:["Booking","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}],Message:["Contact","$q","$rootScope","$timeout",function(a,b,c,d){var e=b.defer();return d(function(){a.getMessage(null,null,c.agent.id).then(function(a){e.resolve(a)})["catch"](function(){e.resolve([])})},1500),e.promise}]}})}]).controller("AgentBookingCtrl",["BookingData","Contact","Modal","gMaps","$scope","CONFIG","Locale","$state","$rootScope","Message","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){e.data=a.data,e.data.checkin=moment.unix(e.data.checkin).utc().format(f.DEFAULT_DATE_FORMAT),e.data.checkout=moment.unix(e.data.checkout).utc().format(f.DEFAULT_DATE_FORMAT),e.contact={name:i.agent.name,email:i.agent.email},e.bookinglink=h.href("booking",{id:e.data.id},{absolute:!0}),_.isEmpty(j)?e.messages={}:(e.messages=j,k(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight)},1e3)),e.priceExtraTotal=0,_.each(e.data.priceExtra,function(a){e.priceExtraTotal=e.priceExtraTotal+parseInt(a.price)}),e.getDay=function(a){return b.getDay(a)},e.translation=e.data.translation,e.property=e.data.property,e.messages=e.data.agentMessages,e.period=function(){return g.period(e.data.nights)},e.askQuestion=function(){b.askQuestion(e.contact,!1,!1,e.data.id).then(function(a){e.messages=a,c.messageReceived(),e.contact.message=""})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent.chat",{url:"chat/:property/",title:"title_chat",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/chat/index.html")},controller:"AgentChatCtrl",resolve:{Message:["Contact","$q","Auth",function(a,b,c){var d=b.defer();return c.checkLogged().then(function(b){a.getMessage(null,b.data.id,null).then(function(a){d.resolve(a)})["catch"](function(a){d.resolve({data:[]})})}),d.promise}]}})}]).controller("AgentChatCtrl",["Message","Contact","Modal","$rootScope","$scope","CONFIG","Locale","$state","$stateParams","$timeout",function(a,b,c,d,e,f,g,h,i,j){e.focusChat=function(){j(function(){jQuery("form[name=contact-form] textarea").focus(),jQuery("form[name=contact-form] input[value='']:not(:checkbox,:button):visible:first").focus()},500)},_.isEmpty(a)?e.messages={}:e.messages=a,e.contact={name:d.agent.name,email:d.agent.email},e.askQuestion=function(){b.askQuestion(e.contact,!1,i.property,!1).then(function(a){e.messages=a,c.messageReceived(),e.contact.message=""})},e.getDay=function(a){return b.getDay(a)}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent",{url:"/agent/",css:"/css/style.css","abstract":!1,template:"<ui-view></ui-view>",controller:["$state",function(a){"agent"===a.current.name&&a.go("agent.home",{},{reload:!0})}],resolve:{Agent:["Auth","$q","$state","$rootScope",function(a,b,c,d){var e=b.defer();return a.checkLogged().then(function(a){return"agent"!==a.data.type?c.go("agent_login"):(d.agent=a.data,void e.resolve(a.data))})["catch"](function(){return c.go("agent_login")}),e.promise}]}}).state("agent.home",{url:"home/",controller:"AgentHomeCtrl",css:"/css/style.css",title:"title_agent_home",templateProvider:function(a){return a.get("templates/agent/home/index.html")},params:{searchonly:!1},resolve:{Results:["Locale","$http","$q","CONFIG","$rootScope","$stateParams",function(a,b,c,d,e,f){var g=c.defer(),h=a.getDates(!0,!0);return b.get(d.API_URL+"/search-booking",{params:{checkin:h.checkin,checkout:h.checkout,format:d.DEFAULT_DATE_FORMAT,language:e.language,location:0,searchonly:f.searchonly}}).then(function(a){g.resolve(a)})["catch"](function(){g.resolve([])}),g.promise}],Bookings:["Auth","$rootScope","Booking","$q",function(a,b,c,d){var e=d.defer();return a.checkLogged().then(function(){return c.find({agent:b.agent.id})}).then(function(a){e.resolve(a.data)})["catch"](function(){e.resolve([])}),e.promise}]}})}]).controller("AgentHomeCtrl",["Results","$stateParams","Bookings","Booking","Calendar","$scope","Auth","$state","$timeout","$rootScope",function(a,b,c,d,e,f,g,h,i,j){f.loadCheckoutDate=1,e.loadCalendar(),b.searchonly&&(f.searchonly=b.searchonly),f.bookings=c,f.nights=e.nights(),f.bookingsLimit=10,f.getStatus=function(a){return d.getStatus(a)},f.prices=a.data.prices,f.defaultPrices=a.data.defaultPrices,f.properties=a.data.free,f.bookedproperties=a.data.booked,f.whenFree=a.data.whenFree,f.$on("datesChanged",function(a,b){2==f.loadCheckoutDate&&"agent.home"==h.current.name&&f.search(f.searchonly),f.loadCheckoutDate++}),f.search=function(a){h.go("agent.home",{searchonly:a},{reload:!0})},f.inittooltip=function(){i(function(){$(".agent-table-tooltp").powerTip({placement:"n",smartPlacement:!0})})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent_login",{controller:"AgentLoginCtrl",url:"/agent/login/",title:"title_agent_login",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/login/index.html")},resolve:{Agent:["Auth","$q","$state",function(a,b,c){var d=b.defer();return a.checkLogged().then(function(a){"agent"===a.data.type?(c.go("agent.home"),d.resolve(a.data)):d.resolve()})["catch"](function(){d.resolve()}),d.promise}]}}).state("agent_logout",{url:"/agent/logout/",resolve:{Logout:["Auth","$q","$state",function(a,b,c){var d=b.defer();return a.logout().then(function(){c.go("home",{},{reload:!0}),d.resolve()})["catch"](function(){c.go("home",{},{reload:!0}),d.resolve()}),d.promise}]}})}]).controller("AgentLoginCtrl",["$scope","Auth","$state",function(a,b,c){a.login=function(d,e){a.$error=!1,b.loginAgent(d,e).then(function(){return c.go("agent.home",{},{reload:!0})})["catch"](function(){a.$error=!0})}}])}(),function(){"use strict";angular.module("ThaiHome").directive("agentNavigation",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/agent/navigation/index.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent_forgot",{url:"/agent/forgot/",controller:"AgentForgotCtrl",title:"title_agent_forgot",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/password-forgot/index.html")},resolve:{Agent:["Auth","$q","$state",function(a,b,c){var d=b.defer();return a.checkLogged().then(function(a){"agent"===a.type?(c.go("agent.home"),d.resolve(a)):d.resolve()})["catch"](function(a){d.resolve()}),d.promise}]}})}]).controller("AgentForgotCtrl",["$scope","Auth","$state","User","Modal",function(a,b,c,d,e){a.forgot=function(c){a.error=!1,b.forgotPassword(c).then(function(){a.success=!0,e["default"]("You will receive an email with further instructions.")})["catch"](function(){a.error=!0})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent_reset",{url:"/agent/reset/:token/",controller:"AgentResetCtrl",title:"title_agent_reset",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/password-reset/index.html")},resolve:{Token:["Auth","$q","$state","$stateParams",function(a,b,c,d){var e=b.defer();return a.checkToken(d.token).then(function(a){
a?e.resolve(a):e.reject()})["catch"](function(a){e.reject()}),e.promise}]}})}]).controller("AgentResetCtrl",["Token","Modal","$scope","User","$state","$stateParams",function(a,b,c,d,e,f){c.update=function(f){var g=a;g.token="",g.password=f,d.update(g.id,g).then(function(a){b["default"]("Password Updated"),e.go("agent_login")})["catch"](function(a){c.error=a})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent.property",{url:"property/:id/:action/",title:"title_property",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/property/index.html")},controller:"PropertyCtrl",resolve:{currentUser:["$q","$rootScope",function(a,b){var c=a.defer();return c.resolve({data:b.agent}),c.promise}],PropertyData:["Property","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}],Ratings:["Rating","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getPropertyRatings(c.id).then(function(a){d.resolve(a)}),d.promise}],Message:["Contact","$q","Auth",function(a,b,c){var d=b.defer();return c.checkLogged().then(function(b){return a.getMessage(null,b.data.id,null)}).then(function(a){d.resolve(a)}),d.promise}]}})}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("agent_register",{url:"/agent/register/",controller:"AgentRegisterCtrl",title:"title_agent_login",css:"/css/style.css",templateProvider:function(a){return a.get("templates/agent/register/index.html")},resolve:{Agent:["Auth","$q","$state",function(a,b,c){var d=b.defer();return a.checkLogged().then(function(a){"agent"===a.type?(c.go("agent.home"),d.resolve(a)):d.resolve()})["catch"](function(){d.resolve()}),d.promise}]}})}]).controller("AgentRegisterCtrl",["User","$scope","Modal",function(a,b,c){b.register=function(){var d={name:b.data.name,agent:b.data.name,agency:b.data.agency,email:b.data.email,password:b.data.password,phone:b.data.phone,website:b.data.website,line_messenger:b.data.line_messenger,whatsapp:b.data.whatsapp,facebook:b.data.facebook,type:"agent",username:b.data.username};a.add(d).then(function(){b.disabled=!0,c.newAgent()})["catch"](function(a){var c="";for(var d in a.data.errors)c+=d+" "+a.data.errors[d];b.error=c})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.book",{url:"book/",controller:"ManagerBookCtrl",title:"title_management_book",templateProvider:function(a){return a.get("templates/management/book/index.html")},params:{property:!1,start:!1,end:!1},css:["/css/admin.css"],resolve:{Dates:["Locale",function(a){var b=a.getDates();return b.valid?{start:b.checkin,end:b.checkout}:{}}],PropertyData:["$stateParams","Property","$q",function(a,b,c){if(a.property){var d=c.defer();return b.getDetails(a.property).then(function(a){d.resolve(a.data)})["catch"](function(){d.reject()}),d.promise}return!1}]}})}]).controller("ManagerBookCtrl",["$scope","$state","$rootScope","Modal","Calendar","$timeout","$http","CONFIG","Notification","Property","Locale","Booking","PropertyData","$stateParams","Dates",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){e.loadCalendar(!1,!1,!1,null),a.booking={},a.data={priceExtra:[],discount:{percent:0},priceDay:0,nights:0,property:{cleanfinalprice:0},priceReservation:0,utilitiesWifi:"Included",utilitiesCable:"Included BTV",agent:{}},a.options={showDiscount:!1,addAgent:!0,addTenant:!0,calendarOpened:!1,showConditions:!1,showExpenses:!1,bookingSaved:!1},m&&(a.data.property=m.property,a.fullPrice=m.price),a.addExtra=function(){a.data.priceExtra.push({name:"Name",price:0})},a.removeDiscount=function(){a.options.showDiscount=!1,a.data.discount={percent:0}},a.removeExtra=function(b){a.data.priceExtra.splice(b,1),a.calcExtra()},a.calcExtra=function(){var b=0;_.each(a.data.priceExtra,function(a){b+=parseInt(a.price)}),a.priceExtraCalc=b},a.propertyList=function(){d.propertyList(a.data.checkin,a.data.checkout)},a.currencyList=function(){d.currencyList()},a.agentList=function(){d.agentList(!0,a.data.agentCommission)},a.tenantList=function(){d.tenantList()},a.discountList=function(){d.discountList()},a.emailList=function(){d.emailList(a.bookingID)},a.openCalendar=function(){a.options.calendarOpened=!0,f(function(){try{$(".arrival").data("dateRangePicker").open()}catch(b){e.destroy(),e.loadCalendar(a.data.checkin||!1,a.data.checkout||!1,!1,a.bookings||null),f(function(){$(".arrival").data("dateRangePicker").open()},100)}})},c.$on("propertySelected",function(b,c){e.destroy(),j.getDetails(c.unique).then(function(b){a.bookings=b.data.bookings,a.fullPrice=b.data.price,a.data.checkin&&a.data.checkout?e.loadCalendar(a.data.checkin,a.data.checkout,!1,a.bookings):e.loadCalendar(!1,!1,!1,a.bookings),f(function(){a.data.property=c,a.data.checkin&&a.data.checkout&&g.get(h.API_URL+"/getprice",{params:{property:a.data.property.id,checkin:a.data.checkin,checkout:a.data.checkout,format:h.DEFAULT_DATE_FORMAT}}).success(function(b){a.data.priceDay=b.price,a.data.nights=b.nights,a.data.utilitiesElectricity=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",a.data.utilitiesWater=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",b.nights<7?a.data.agentCommission=a.fullPrice.commissionDay:b.nights<30?a.data.agentCommission=a.fullPrice.commissionWeek:b.nights<365?a.data.agentCommission=a.fullPrice.commissionMonth:a.data.agentCommission=a.fullPrice.commissionYear})})})}),c.$on("agentSelected",function(b,c,d,e){a.data.agentCommission=d,a.data.conditionsAgent=e,a.data.agent=c}),c.$on("tenantSelected",function(b,c){a.data.tenant=c}),c.$on("discountSelected",function(b,c){a.data.discount=c,a.options.showDiscount=!0}),c.$on("datesChanged",function(b,c){a.applyDates(c)}),a.applyDates=function(b){a.options.calendarOpened&&f(function(){a.data.checkin=b.checkin,a.data.checkout=b.checkout,a.data.property.id&&g.get(h.API_URL+"/getprice",{params:{property:a.data.property.id,checkin:b.checkin,checkout:b.checkout,format:h.DEFAULT_DATE_FORMAT}}).success(function(b){a.data.priceDay=b.price,a.data.nights=b.nights,a.data.utilitiesElectricity=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",a.data.utilitiesWater=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",b.nights<7?a.data.agentCommission=a.fullPrice.commissionDay:b.nights<30?a.data.agentCommission=a.fullPrice.commissionWeek:b.nights<365?a.data.agentCommission=a.fullPrice.commissionMonth:a.data.agentCommission=a.fullPrice.commissionYear})})},n.property&&n.start&&n.end&&(a.options.calendarOpened=!0,a.data.checkin=n.start,a.data.checkout=n.end,a.applyDates({checkin:n.start,checkout:n.end})),a.book=function(){var b=0;a.data.rentpayday>0&&a.data.rentpayday<=31&&(parseInt(moment().utc().format("D"))<=parseInt(a.data.rentpayday)?(b=moment.utc(moment.utc().format("YYYY")+"-"+moment.utc().format("MM"),"YYYY-MM").format("YYYY-MM"),b=b+"-"+a.data.rentpayday,b=moment.utc(b,"YYYY-MM-D").unix()):(b=moment.utc(moment().utc().format("YYYY")+"-"+moment.utc().add(1,"month").format("MM"),"YYYY-MM").format("YYYY-MM"),b=b+"-"+a.data.rentpayday,b=moment.utc(b,"YYYY-MM-D").unix()));var e={property:a.data.property.id,user:{email:a.data.tenant.email,name:a.data.tenant.name},agent:a.data.agent.id?a.data.agent.id:"",agentCommission:a.data.agentCommission,discount:a.data.discount.id,discountPercentage:a.data.discount.percent,checkin:moment.utc(a.data.checkin,h.DEFAULT_DATE_FORMAT).startOf("day").unix(),checkout:moment.utc(a.data.checkout,h.DEFAULT_DATE_FORMAT).startOf("day").unix(),status:0,currency:_.findWhere(c.currencies,{currency:localStorage.getItem("currency")}).id,priceExtra:a.data.priceExtra,paymentType:0,priceDay:a.data.priceDay,created:moment().utc().unix(),utilitiesElectricity:a.data.utilitiesElectricity,utilitiesWater:a.data.utilitiesWater,utilitiesWifi:a.data.utilitiesWifi,utilitiesCable:a.data.utilitiesCable,rate:c.currencyRate,cleanfinalprice:a.data.property.cleanfinalprice,cleanprice:a.data.property.cleanprice,expires:moment().utc().add(h.BOOKING_DAYS_EXPIRE,"day").unix(),nights:a.data.nights,conditionsAgent:a.data.conditionsAgent,conditionsTenant:a.data.conditionsTenant,pricePaid:0,priceReservation:a.data.priceReservation,emails:[],rentpayday:a.data.rentpayday||0,nextpayment:b};l.newBooking(e).then(function(b){d.newBookingManagement(b.data.id),a.options.bookingSaved=!0,a.bookingID=b.data.id})["catch"](function(a){a.data&&a.data.errors?i.error({message:JSON.stringify(a.data.errors)}):i.error({message:JSON.stringify(a.data)})})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.booking",{url:"booking/:id/",controller:"ManagerBookingCtrl",params:{check:!1},title:"title_management_booking",css:["/css/admin.css"],templateProvider:function(a){return a.get("templates/management/booking/index.html")},resolve:{BookingData:["Booking","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}})}]).controller("ManagerBookingCtrl",["$scope","$state","$stateParams","$rootScope","Modal","Calendar","$timeout","$http","CONFIG","Notification","Property","Locale","Booking","BookingData","Countries","User",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.data=n.data,a.data.status=a.data.status.toString(),a.data.priceExtra=a.data.priceExtra||[],a.data.checkin=moment.unix(a.data.checkin).utc().format(i.DEFAULT_DATE_FORMAT),a.data.checkout=moment.unix(a.data.checkout).utc().format(i.DEFAULT_DATE_FORMAT),k.getDetails(a.data.property.unique).then(function(b){a.fullPrice=b.data.price,f.loadCalendar(a.data.checkin,a.data.checkout,!1,_.without(b.data.bookings,_.findWhere(b.data.bookings,{id:a.data.id})))}),a.updateUser=function(){p.update(a.data.user.id,a.data.user)},a.countries=o.list,a.statuses=m.getStatus(null,!0),a.sources=m.getSources(null,!0),a.options={calendarOpened:!0},a.addExtra=function(){a.data.priceExtra.push({name:"Extra",price:0})},a.removeExtra=function(b){a.data.priceExtra.splice(b,1),a.calcExtra()},a.calcExtra=function(){var b=0;_.each(a.data.priceExtra,function(a){b+=parseInt(a.price)}),a.priceExtraCalc=b},a.calcExtra(),a.agentList=function(){e.agentList()},a.tenantList=function(){e.tenantList()},a.discountList=function(){e.discountList()},a.statusList=function(){e.statusList(m.getStatus(null,!0))},a.propertyList=function(){e.propertyList(a.data.checkin,a.data.checkout)},a.openCalendar=function(){return a.data.property.id?(a.options.calendarOpened=!0,void g(function(){$(".arrival").data("dateRangePicker").open()})):j.error({message:"Please select a property first"})},a.emailList=function(){e.emailList(a.data.id,a.data.emails,"",a.data.user.id)},d.$on("updateStatus",function(b,c){m.update(c.id,{status:c.status}).then(function(){a.data.status=c.status,j.success({message:"Status updated!"})})}),d.$on("propertySelected",function(b,c){f.destroy(),k.getDetails(c.unique).then(function(b){var d=b.data.bookings;f.loadCalendar(a.data.checkin,a.data.checkout,!1,d),a.fullPrice=b.data.price,g(function(){a.data.property=c,a.data.checkin&&a.data.checkout&&h.get(i.API_URL+"/getprice",{params:{property:a.data.property.id,checkin:a.data.checkin,checkout:a.data.checkout,format:i.DEFAULT_DATE_FORMAT}}).success(function(b){a.data.priceDay=b.price,a.data.nights=b.nights,a.data.utilitiesElectricity=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",a.data.utilitiesWater=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",b.nights<7?a.data.agentCommission=a.fullPrice.commissionDay:b.nights<30?a.data.agentCommission=a.fullPrice.commissionWeek:b.nights<365?a.data.agentCommission=a.fullPrice.commissionMonth:a.data.agentCommission=a.fullPrice.commissionYear})})})}),d.$on("agentSelected",function(b,c){a.data.agent=c}),d.$on("tenantSelected",function(b,c){a.data.user=c}),d.$on("discountSelected",function(b,c){a.data.discount=c}),d.$on("statusSelected",function(b,c){a.data.status=c.value}),d.$on("datesChanged",function(b,c){a.options.calendarOpened&&g(function(){a.data.checkin=c.checkin,a.data.checkout=c.checkout,a.data.property.id&&h.get(i.API_URL+"/getprice",{params:{property:a.data.property.id,checkin:c.checkin,checkout:c.checkout,format:i.DEFAULT_DATE_FORMAT}}).success(function(b){a.data.priceDay=b.price,a.data.nights=b.nights,a.data.utilitiesElectricity=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",a.data.utilitiesWater=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",b.nights<7?a.data.agentCommission=a.fullPrice.commissionDay:b.nights<30?a.data.agentCommission=a.fullPrice.commissionWeek:b.nights<365?a.data.agentCommission=a.fullPrice.commissionMonth:a.data.agentCommission=a.fullPrice.commissionYear})})}),a.getStatus=function(a){return m.getStatus(a)},a["delete"]=function(a){m["delete"](a).then(function(){j.success({message:"Booking Deleted !"}),b.go("management.home",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?j.error({message:JSON.stringify(a.data.errors)}):j.error({message:JSON.stringify(a.data)})})},a.update=function(){var c=0;a.data.rentpayday>0&&a.data.rentpayday<=31&&(parseInt(moment().utc().format("D"))<=parseInt(a.data.rentpayday)?(c=moment.utc(moment.utc().format("YYYY")+"-"+moment.utc().format("MM"),"YYYY-MM").format("YYYY-MM"),c=c+"-"+a.data.rentpayday,c=moment.utc(c,"YYYY-MM-D").unix()):(c=moment.utc(moment().utc().format("YYYY")+"-"+moment.utc().add(1,"month").format("MM"),"YYYY-MM").format("YYYY-MM"),c=c+"-"+a.data.rentpayday,c=moment.utc(c,"YYYY-MM-D").unix()));var d={property:a.data.property.id,user:a.data.user.id,agent:a.data.agent.id?a.data.agent.id:"",agentCommission:a.data.agentCommission,discount:a.data.discount.id,discountPercentage:a.data.discount.percent,checkin:a.data.checkin?moment.utc(a.data.checkin,i.DEFAULT_DATE_FORMAT).startOf("day").unix():"",checkout:a.data.checkout?moment.utc(a.data.checkout,i.DEFAULT_DATE_FORMAT).startOf("day").unix():"",status:a.data.status,currency:a.data.currency,priceExtra:a.data.priceExtra,paymentType:a.data.paymentType,priceDay:a.data.priceDay,created:moment.utc().unix(),utilitiesElectricity:a.data.utilitiesElectricity,utilitiesWater:a.data.utilitiesWater,utilitiesWifi:a.data.utilitiesWifi,utilitiesCable:a.data.utilitiesCable,rate:1,cleanfinalprice:a.data.property.cleanfinalprice,cleanprice:a.data.property.cleanprice,expires:a.data.expires,nights:a.data.nights,conditionsAgent:a.data.conditionsAgent,conditionsTenant:a.data.conditionsTenant,pricePaid:a.data.pricePaid,priceReservation:a.data.priceReservation,emails:a.data.emails,rentpayday:a.data.rentpayday,nextpayment:c,comment:a.data.comment,source:a.data.source};m.update(a.data.id,d).then(function(){j.success({message:"Booking Updated !"}),b.go("management.home",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?j.error({message:JSON.stringify(a.data.errors)}):j.error({message:JSON.stringify(a.data)})})},c.check&&m.update(a.data.id,{checked:!0})}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.bookings",{url:"bookings/",controller:"ManagementBookingsCtrl",title:"title_management_bookings",css:["/css/admin.css"],templateProvider:function(a){return a.get("templates/management/bookings/index.html")},params:{bookingType:0},resolve:{Bookings:["Booking","$q","$rootScope","$stateParams",function(a,b,c,d){var e=b.defer();return a.findManagementOld({status:parseInt(d.bookingType)}).then(function(a){e.resolve(a.data)})["catch"](function(){e.resolve([])}),e.promise}]}})}]).controller("ManagementBookingsCtrl",["Bookings","Notification","$state","Booking","$stateParams","$scope","DTOptionsBuilder",function(a,b,c,d,e,f,g){f.dtOptions=g.newOptions().withOption("iDisplayLength",50),f.bookings=a,f.bookingType=e.bookingType.toString(),f.getStatus=function(a){return d.getStatus(a)},f.statuses=d.getStatus(!1,!0),f.selected=[],f.query={filter:"",order:"checkin",page:1},f.selectBooking=function(){if(b.success({message:"Loading..."}),"old"===f.bookingType){var a=moment().add(-14,"day").format("x"),e={status:{$in:[0,1,2]},created:{$lte:a}};d.find(e).then(function(a){f.bookings=a.data})}else if("all"===f.bookingType)d.find({}).then(function(a){f.bookings=a.data});else{var g=parseInt(f.bookingType);c.go("management.bookings",{bookingType:g},{reload:!0,notify:!0})}}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.calendar",{url:"calendar/:month/:year/",title:"title_calendar",css:"/css/admin.css",templateProvider:function(a){return a.get("templates/management/calendar/index.html")},controller:"ManagementCalendarCtrl",resolve:{CalendarData:["$http","$q","$stateParams","CONFIG",function(a,b,c,d){var e=b.defer();return a.get(d.API_URL+"/calendar",{params:{month:""===c.month?moment().format("M"):moment(c.month,"MMMM").format("M"),year:c.year||moment().format("YYYY")}}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a,404)}),e.promise}]}})}]).controller("ManagementCalendarCtrl",["CalendarData","$scope","$stateParams","$state","Booking","CONFIG","$timeout","Notification","Locale",function(a,b,c,d,e,f,g,h,i){b.data=a,b.year=c.year||moment().format("YYYY"),b.month=""===c.month?moment().format("MMMM"):moment(c.month,"MMMM").format("MMMM"),b.nextMonth=moment(c.month,"MMMM").add(1,"month").format("MMMM");var j={0:"#C00000",1:"#C00000",2:"#DE6908",3:"#006000",4:"#006000",5:"#808080",6:"#808080"},k=moment(b.year+"-"+b.month+"-01","YYYY-MMMM-DD").format("YYYY-MM-DD");b.dates={start:1,end1:moment("01-"+b.month+"-"+b.year,"DD-MMMM-YYYY").endOf("month").format("DD"),end2:moment("01-"+b.month+"-"+b.year,"DD-MMMM-YYYY").add(1,"month").endOf("month").format("DD")};var l=moment("01-"+b.month+"-"+b.year,"DD-MMMM-YYYY").add(1,"month").endOf("month").diff(moment("01-"+b.month+"-"+b.year,"DD-MMMM-YYYY"),"days")+1;moment().format("MMMM YYYY")===c.month+" "+c.year&&(k=moment().subtract(1,"day").format("YYYY-MM-DD")),b.reload=function(){d.go("management.calendar",{year:b.year,month:b.month},{reload:!0,inherit:!1,notify:!0})},b.next=function(){var a=parseInt(moment(b.month,"MMMM").format("M"));a++;var c=b.year;13===a&&(a=1,c++),b.month=moment(a,"M").format("MMMM"),b.year=c,b.reload()},b.previous=function(){var a=parseInt(moment(b.month,"MMMM").format("M"));a--;var c=b.year;0===a&&(a=12,c--),b.month=moment(a,"M").format("MMMM"),b.year=c,b.reload()},b.status=function(a){return e.getStatus(a).name};var m=new DayPilot.Scheduler("dp");m.startDate=k,m.days=l,m.scale="Day",m.timeHeaders=[{groupBy:"Month",format:"MMM yyyy"},{groupBy:"Cell",format:"ddd d"}],m.bubble=new DayPilot.Bubble,m.resourceBubble=new DayPilot.Bubble,m.contextMenu=new DayPilot.Menu({items:[{text:"Select",onclick:function(){m.multiselect.add(this.source)}}]});var n=_.map(b.data.properties,function(a){return{name:a.unique,id:a.unique}});m.treeEnabled=!1,m.resources=n,m.heightSpec="Max",m.height=35*b.data.properties.length,m.events.list=[],_.each(b.data.data,function(a){var b={start:new DayPilot.Date(a.checkin),end:new DayPilot.Date(a.checkout),id:DayPilot.guid(),resource:a.property,text:'<div style="color:#fff;background:'+j[a.status]+';"><b style="color:yellow">[T]</b><b> '+a.user+"</b><div>",status:a.status,moveDisabled:!0,resizeDisabled:!0,bid:a.id,cssClassPrefix:"bubble_thaihome"};m.events.list.push(b)}),m.cellWidthSpec="Auto",m.eventMovingStartEndEnabled=!0,m.eventResizingStartEndEnabled=!1,m.timeRangeSelectingStartEndEnabled=!0,m.onBeforeResHeaderRender=function(a){a.resource.bubbleHtml="ThaiHome Calendar"},m.onBeforeCellRender=function(a){(0===a.cell.start.getDayOfWeek()||6===a.cell.start.getDayOfWeek())&&(a.cell.backColor="#d6d6d6")},m.onBeforeRowHeaderRender=function(a){},m.onBeforeEventRender=function(a){a.data.bubbleHtml="<div class='man_calendar_pop' style='background:#e8f896;margin:-5px;padding:3px;border:1px solid #000'><b>"+a.data.text.replace('style="color:yellow"',"")+"</b></div><div><b>"+b.status(a.data.status)+"</b></div><div>Start: "+new DayPilot.Date(a.data.start).toString("dd/MM/yyyy")+"</div><div>End: "+new DayPilot.Date(a.data.end).toString("dd/MM/yyyy")+"</div>"},m.onTimeRangeSelected=function(a){h.success({message:"Checking dates..."});var c=moment(a.start.toString().split("T")[0],"YYYY-MM-DD").format(f.DEFAULT_DATE_FORMAT),d=moment(a.end.toString().split("T")[0],"YYYY-MM-DD").format(f.DEFAULT_DATE_FORMAT);e.check(a.resource,null,{checkin:c,checkout:d}).then(function(e){m.clearSelection(),e?alert("Dates already booked"):g(function(){confirm("Create Booking?")&&(i.setDates(c,d),b.doBooking(a))})})},b.doBooking=function(a){d.go("management.book",{property:a.resource,start:moment(a.start.value).format("MMM D, YYYY"),end:moment(a.end.value).format("MMM D, YYYY")})},m.treePreventParentUsage=!0,m.onEventClicked=function(a){var b=d.href("management.booking",{id:a.e.data.bid});window.open(b,"_blank")};for(var o=[],p=0;l>=p;p++){var q=moment("01-"+parseInt(moment(b.month,"MMMM").format("MM"))+"-"+b.year,"DD-MM-YYYY").add(p,"days");1==q.weekday()&&o.push({color:"black",location:q.format("YYYY-MM-DD"),width:1})}m.init(),$(".scheduler_default_corner").html("")}]).directive("yearDrop",function(){function a(a,b){for(var c=parseInt(moment().format("YYYY")),d=[],e=0;b+1>e;e++)d.push(c+a+e);return d}return{link:function(b,c,d){b.years=a(+d.offset,+d.range),b.year=parseInt(d.year)},template:'<select ng-model="year" ng-options="y for y in years"></select>'}}).directive("monthDrop",function(){function a(){var a=["January","February","March","April","May","June","July","August","September","October","November","December"];return a}return{link:function(b,c,d){b.months=a(),b.month=d.month},template:'<select ng-model="month" ng-options="m for m in months"></select>'}}).filter("range",function(){return function(a,b){b=parseInt(b);for(var c=1;b>=c;c++)a.push(c);return a}}).filter("dayName",function(){return function(a,b){return moment(a+" "+b,"DD MMMM").format("dd DD")}})}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management",{url:"/management/",css:["/css/admin.css"],template:"<ui-view></ui-view>",controller:["$state",function(a){return"management"===a.current.name?a.go("management.home"):void 0}],resolve:{Admin:["Auth","$q","$state","$rootScope",function(a,b,c,d){var e=b.defer();return a.checkLogged().then(function(a){"admin"===a.data.type?(d.admin=a.data,e.resolve(a)):(c.go("admin_login",{to:"management"}),e.reject())})["catch"](function(){c.go("admin_login",{to:"management"}),e.reject()}),e.promise}],Bookings:["Booking","$q","$rootScope","$stateParams",function(a,b,c,d){var e=b.defer();return a.findManagement({status:parseInt(d.bookingType)}).then(function(a){c.menu_bookings=0,_.each(a.data.data,function(a){c.menu_bookings=c.menu_bookings+a.length}),e.resolve(a.data)})["catch"](function(){c.menu_bookings=0,e.resolve([])}),e.promise}],Messages:["Contact","$q","$rootScope",function(a,b,c){var d=b.defer();return a.getUnreadCount().then(function(a){c.menu_messages=a,d.resolve()})["catch"](function(){c.menu_messages=0,d.resolve([])}),d.promise}]}}).state("management.home",{url:"home/",controller:"ManagementHomeCtrl",title:"title_agent_home",css:["/css/admin.css"],templateProvider:function(a){return a.get("templates/management/home/index.html")}})}]).controller("ManagementHomeCtrl",["Bookings","Notification","$state","Booking","$stateParams","$scope","$rootScope","DTOptionsBuilder","Modal",function(a,b,c,d,e,f,g,h,i){f.dtOptions=h.newOptions(),f.bookings=a.data,f.users=a.users,f.properties=a.properties,f.prices=a.prices,f.today=moment().utc().format("x"),f.getStatus=function(a){return d.getStatus(a)},f.statuses=d.getStatus(!1,!0),f.calcDays=function(a,b){return b||(b=moment().utc().unix()),moment.utc(a,"X").diff(moment.utc(b,"X"),"days")},f.newBookingCalc=function(a){var b=_.findWhere(a.emails,{email:"booking_confirmation"}),c=_.findWhere(a.emails,{email:"booking_reminder"});return c?f.calcDays(c.date):b?f.calcDays(b.date):f.calcDays(a.created)},f.newBookingButton=function(a){var b=_.findWhere(a.emails,{email:"booking_confirmation"}),c=_.findWhere(a.emails,{email:"booking_reminder"});return a.checked?c?"cancel":b?"remind":"send":"check"},f.pendingBookingCalc=function(a){var b=_.findWhere(a.emails,{email:"booking_confirmation"}),c=_.findWhere(a.emails,{email:"booking_reminder"});return c?f.calcDays(c.date):b?f.calcDays(b.date):f.calcDays(a.created)},f.recurringBookingButton=function(a){var b=f.calcDays(moment.utc().unix(),a.nextpayment),c=[],d=!0;_.each(a.emails,function(a){"long_term_invoice"===a.email&&c.push(a.date)}),c=c.sort();var e=c[c.length-1]||moment().utc().unix();return f.calcDays(moment(e,"X").utc().unix())>15&&(d=!1),moment.utc().unix()>a.nextpayment&&15>b?"late":moment.utc().unix()>a.nextpayment&&b>=15?"evict":d&&c.length?void 0:"invoice"},f.pendingBookingButton=function(a){var b=_.findWhere(a.emails,{email:"booking_reminder"});return a.paymentconfirmed?"paid":b?"cancel":"remind"},f.cancel=function(a,b){d.update(a.id,{status:7}).then(function(){_.each(f.bookings,function(b,c){f.bookings[c]=_.without(f.bookings[c],a)})})},f.check=function(a){c.go("management.booking",{id:a.id,check:!0}),_.each(f.bookings["new"],function(b){a.id===b.id&&(a.checked=!0)})},f.remind=function(a,b){i.emailList(a.id,a.emails,b,a.user)},f.paid=function(a){d.update(a.id,{paymentconfirmed:!0,status:4}),_.map(f.bookings,function(b,c){var d=_.findWhere(b,{id:a.id});d&&(f.bookings[c]=_.without(f.bookings[c],d))})},f.sum=function(a){var b=0;_.each(a.priceExtra,function(a){b=parseFloat(b)+parseFloat(a.price)});var c=a.nights*a.priceDay-a.nights*a.priceDay/100*parseInt(a.discountPercentage)+parseFloat(b)+a.cleanfinalprice;return c=(c*a.rate).toFixed(0)},g.$on("emailSent",function(a,b){var c=b.booking;_.map(f.bookings,function(a,e){var g=_.findWhere(a,{id:c});g&&("rating"===b.type&&"checkout"===e?(d.update(g.id,{status:5}),f.bookings[e]=_.without(f.bookings[e],g)):"checkin_reminder"===b.type&&"arrival"===e?f.bookings[e]=_.without(f.bookings[e],g):"long_term_receipt"===b.type&&"recurring"===e&&(f.bookings[e]=_.without(f.bookings[e],g)),_.each(f.bookings[e],function(a){a.id===c&&a.emails.push({date:moment().utc().unix(),email:b.type})}))})})}])}(),function(){"use strict";angular.module("ThaiHome").directive("managementMenu",["$templateCache",function(a){return{template:function(){return a.get("templates/management/menu/index.html")},controller:"ManagementMenuCtrl",restrict:"AE"}}]).controller("ManagementMenuCtrl",["$rootScope","$state","$scope",function(a,b,c){c.menu_messages=a.menu_messages,c.menu_bookings=a.menu_bookings,c.statename=b.current.name}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.message",{url:"message/:id/",css:["/css/admin.css"],controller:"ManagerMessageCtrl",title:"title_management_properties",templateProvider:function(a){return a.get("templates/management/message/index.html")},resolve:{Message:["Contact","$stateParams","$q",function(a,b,c){var d=c.defer();return a.getMessage(b.id).then(function(c){d.resolve(c),c.read||a.readMessage(b.id)}),d.promise}]}})}]).controller("ManagerMessageCtrl",["Message","Contact","$stateParams","$scope","$timeout",function(a,b,c,d,e){d.messages=a,e(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight)},1e3),d.lastUnread=b.latestUnread(d.messages),d.getDay=function(a){return b.getDay(a)},d.contact=a.user,d.askQuestion=function(){b.getMessage(c.id).then(function(a){b.replyQuestion(a,d.contact.message).then(function(b){d.messages=a,d.contact.message=""})})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.messages",{url:"messages/",css:["/css/admin.css"],controller:"ManagerMessagesCtrl",title:"title_management_properties",templateProvider:function(a){return a.get("templates/management/messages/index.html")},resolve:{Messages:["Contact","$q",function(a,b){var c=b.defer();return a.getUnread({sort:{updated:1}}).then(function(a){c.resolve(a)}),c.promise}]}})}]).controller("ManagerMessagesCtrl",["Messages","Calendar","$stateParams","$scope","Contact","Notification",function(a,b,c,d,e,f){d.skip=25,d.limit=10,_.isObject(a)&&!_.isArray(a)?d.unread=[a]:d.unread=a,d.lastUnread=function(a){return e.latestUnread(a)},d.timeDiff=moment.utc().subtract(24,"hours").unix(),d.load=function(){e.getUnread({limit:d.limit,skip:d.skip,sort:{updated:1}}).then(function(a){a.length?(d.unread=_.union(d.unread,a),d.skip+=d.limit):(d.noMore=!0,f.info({message:'<span style="color:#fff">No more messages</span>',delay:2e3}))})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.newbooking",{url:"newbooking/:id/",controller:"ManagerNewBookingCtrl",params:{check:!1},title:"title_management_booking",css:["/css/admin.css"],templateProvider:function(a){return a.get("templates/management/newbooking/index.html")},resolve:{BookingData:["Booking","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}})}]).run(["$rootScope","$templateCache",function(a,b){a.$on("$routeChangeStart",function(){b.removeAll()})}]).controller("ManagerNewBookingCtrl",["$scope","$state","$stateParams","$rootScope","Modal","Calendar","$timeout","$http","CONFIG","Notification","Property","Locale","Booking","BookingData","Countries","User","$templateCache","Payment","Email","$sce","$filter","Invoice","Receipt",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){a.data=n.data,a.paymentMethods=r.methods(),a.extraPrice=[],a.currentExtraMultiply=[],a.voucher=!1,a.locationThis=window.location.href.replace(window.location.pathname,"")+"/",a.copyLocation=window.location.href.replace("management/new",""),a.data.status=a.data.status.toString(),a.data.priceExtra=a.data.priceExtra||[],a.newInvoiceFields=[],a.newInvoiceTotal=0,a.newInvoiceDueDate=0,a.bookingInvoices=[],a.newInvoiceNumber=a.data.invoice.length+1,a.newInvoiceCreateDate=0,a.newInvoicepaymentSuggest=0,a.invoiceActionStatus=!1,w.getAll().then(function(b){a.ReceiptCount=b.length}),a.currentReceipt={paidDate:new Date,amount:0,account:0,managerId:a.admin.id,receiptNo:a.ReceiptCount+1},a.addReceipt=function(){w.add()},a.editInvoice=function(b){a.invoiceActionStatus=!0,a.newInvoiceFields=b.invoiceLines,a.newInvoiceTotal=a.getInvoiceTotal(b),a.newInvoiceDueDate=b.dueDate,a.newInvoiceNumber=b.invoiceNumber,a.newInvoiceCreateDate=b.createDate,a.newInvoicepaymentSuggest=0,a.thisInvoiceId=b.id},a.deleteInvoice=function(b){a.data.invoice=a.data.invoice.filter(function(a){return a.id!=b}),v["delete"](b).then(function(a){j.success({message:"Invoice deleted."})}),a.currentReceipt={paidDate:new Date,amount:0,account:0,managerId:a.admin.id,receiptNo:a.ReceiptCount+1}},a.convertBillsToInvoice=function(){document.getElementById("invoiceForm").style.display="block",console.log("converting to invoice"),a.invoiceActionStatus=!1,a.newInvoiceFields=[{lineText:"Electric",amountPcs:a.data.electricTo-a.data.electricFrom+" x "+a.data.property.electricUnit,amountTotal:(a.data.electricTo-a.data.electricFrom)*a.data.property.electricUnit},{lineText:"Wather",amountPcs:a.data.waterTo-a.data.waterFrom+" x "+a.data.property.waterUnit,amountTotal:(a.data.waterTo-a.data.waterFrom)*a.data.property.waterUnit}],a.newInvoiceTotal=(a.data.waterTo-a.data.waterFrom)*a.data.property.waterUnit+(a.data.electricTo-a.data.electricFrom)*a.data.property.electricUnit,a.newInvoiceDueDate=0,a.newInvoiceNumber=a.data.invoice.length+1,a.newInvoiceCreateDate=0,a.newInvoicepaymentSuggest=0,a.currentReceipt={paidDate:new Date,amount:0,account:0,managerId:a.admin.id,receiptNo:a.ReceiptCount+1}},a.cancelInvoice=function(){a.invoiceActionStatus=!1,a.newInvoiceFields=[{lineText:"",amountPcs:"",amountTotal:0}],a.newInvoiceTotal=0,
a.newInvoiceDueDate=0,a.newInvoiceNumber=a.data.invoice.length+1,a.newInvoiceCreateDate=0,a.newInvoicepaymentSuggest=0,a.currentReceipt={paidDate:new Date,amount:0,account:0,managerId:a.admin.id,receiptNo:a.ReceiptCount+1}},a.getInvoiceTotal=function(a){for(var b=0,c=0;c<a.invoiceLines.length;c++)b+=a.invoiceLines[c].amountTotal;return b},a.saveInvoice=function(){a.invoiceActionStatus?v.add({id:a.thisInvoiceId,invoiceNumber:a.newInvoiceNumber,bookingId:a.data.id,propertyId:a.data.property.id,createDate:a.newInvoiceCreateDate,dueDate:a.newInvoiceDueDate,paidDate:"",paymentSuggest:a.newInvoicepaymentSuggest,managerId:a.admin.id,invoiceLines:a.newInvoiceFields}).then(function(b){j.success({message:"Created a new invoice."});for(var c=0;c<a.data.invoice.length;c++)a.data.invoice.id==a.thisInvoiceId&&(a.data.invoice={id:a.thisInvoiceId,invoiceNumber:a.newInvoiceNumber,bookingId:a.data.id,propertyId:a.data.property.id,createDate:a.newInvoiceCreateDate,dueDate:a.newInvoiceDueDate,paidDate:"",paymentSuggest:a.newInvoicepaymentSuggest,managerId:a.admin.id,invoiceLines:a.newInvoiceFields});a.newInvoiceFields=[{lineText:"",amountPcs:"",amountTotal:0}],a.newInvoiceTotal=0,a.newInvoiceDueDate=0,a.newInvoiceNumber++,a.newInvoiceCreateDate=0,a.newInvoicepaymentSuggest=0,a.currentReceipt={paidDate:new Date,amount:0,account:0,managerId:a.admin.id,receiptNo:a.ReceiptCount+1},document.getElementById("invoiceForm").style.display="none"}):v.add({invoiceNumber:a.newInvoiceNumber,bookingId:a.data.id,propertyId:a.data.property.id,createDate:a.newInvoiceCreateDate,dueDate:a.newInvoiceDueDate,paidDate:"",paymentSuggest:a.newInvoicepaymentSuggest,managerId:a.admin.id,invoiceLines:a.newInvoiceFields}).then(function(b){a.data.invoice.push(b),j.success({message:"Created a new invoice."}),a.newInvoiceFields=[{lineText:"",amountPcs:"",amountTotal:0}],a.newInvoiceTotal=0,a.newInvoiceDueDate=0,a.newInvoiceNumber++,a.newInvoiceCreateDate=0,a.newInvoicepaymentSuggest=0,document.getElementById("invoiceForm").style.display="none",a.currentReceipt={paidDate:new Date,amount:0,account:0,managerId:a.admin.id,receiptNo:a.ReceiptCount+1}})},a.calculateNewInvoiceTotal=function(){a.newInvoiceTotal=0;for(var b=0;b<a.newInvoiceFields.length;b++)a.newInvoiceTotal+=Number(a.newInvoiceFields[b].amountTotal)||0},a.addNewInvoiceLine=function(){a.newInvoiceFields.push({lineText:"",amountPcs:"",amountTotal:0})},a.addNewInvoiceLine(),a.data.priceExtra.length||a.data.priceExtra.push({name:"Final cleaning",calc:"1 X 750",price:"750"}),a.userEmail=a.data.user.email,s.list().then(function(b){a.emails=_.sortBy(b,function(a){return a.name}),a.languages=d.languages,a.emailLanguage="en",a.searchEmail=function(b){var c=_.findWhere(a.data.emails,{email:b});return c?" - Sent "+u("timeAgo")(c.date):""},a.getEmailHTML=function(b){s.send(b,{booking:a.data.id,preview:!0,subject:d.T["email_subject_"+b],language:"en",userID:d.admin.id}).then(function(b){a.emailHTML=t.trustAsHtml('<div style="overflow-y:auto;">'+b.html+"</div>"),a.subject=b.subject})},a.selectLang=function(b){a.emailLanguage=b},a.tenantDetail={},a.getTenantDetail=function(b){p.getDetails(b).then(function(b){a.tenantDetail=b})},a.sendVoucher=function(){a.voucher=!a.voucher},a.addhttp=function(a){return/^(f|ht)tps?:\/\//i.test(a)||(a="http:"+a),a},a.sendEmail=function(b,c,e,f){console.log(a.voucher),j.success({message:"Sending email."}),a.voucher?h.get(i.API_URL+"/pdf",{params:{url:$("#printedArea").find(".container").html()}}).success(function(g){var h=g.filename;j.success({message:"Email sent!"}),document.getElementById("mailLayer").style.display="none",s.send(b,{booking:a.data.id,customHTML:e.toString(),preview:c||!1,customSubject:f,language:"en",userID:d.admin.id,userEmail:a.userEmail,fileName:h}).then(function(c){d.$broadcast("emailSent",{booking:a.data.id,type:b}),"rating"==b&&d.$broadcast("updateStatus",{id:a.data.id,status:6}),document.getElementById("mailLayer").style.display="none"})["catch"](function(a){j.error({message:a})})}):(j.success({message:"Email sent!"}),document.getElementById("mailLayer").style.display="none",s.send(b,{booking:a.data.id,customHTML:e.toString(),preview:c||!1,customSubject:f,language:"en",userID:d.admin.id,userEmail:a.userEmail}).then(function(c){d.$broadcast("emailSent",{booking:a.data.id,type:b}),"rating"==b&&d.$broadcast("updateStatus",{id:a.data.id,status:6})})["catch"](function(a){j.error({message:a})}))}}),a.data.checkin=moment.unix(a.data.checkin).utc().format(i.DEFAULT_DATE_FORMAT),a.data.checkout=moment.unix(a.data.checkout).utc().format(i.DEFAULT_DATE_FORMAT),k.getDetails(a.data.property.unique).then(function(b){a.fullPrice=b.data.price,f.loadCalendar(a.data.checkin,a.data.checkout,!1,_.without(b.data.bookings,_.findWhere(b.data.bookings,{id:a.data.id})))}),""!=a.data.discountAmount&&a.data.discountAmount&&"undefined"!=typeof a.data.discountAmount?a.discountPrice=parseInt(a.data.discountAmount):a.discountPrice=a.data.nights*a.data.priceDay/100*(a.data.discount.percent||0),console.log("asdsadasdas$",a.discountPrice,a.data.discountAmount);var x=document.querySelector("#copy_btn");x.addEventListener("click",function(){j.success({message:"Link has been copied."});var a=document.querySelector("#data_id");a.select(),document.execCommand("copy")},!1),a.updateUser=function(){p.update(a.data.user.id,a.data.user)},a.countries=o.list,a.statuses=m.getStatus(null,!0),a.sources=m.getSources(null,!0),a.options={calendarOpened:!0},a.addExtra=function(){a.data.priceExtra.push({name:"",calc:"",price:""})},a.calcExtraPrice=function(b){a.data.priceExtra[b].price=a.currentExtraMultiply[b]*a.extraPrice[b]},a.removeExtra=function(b){a.data.priceExtra.splice(b,1),a.calcExtra()},a.calcExtra=function(){var b=0;_.each(a.data.priceExtra,function(a){isNaN(parseInt(a.price))||(b+=parseInt(a.price))}),a.priceExtraCalc=b},a.getExtrasPrices=function(){return a.calcExtra(),a.data.priceDay*a.data.nights-a.discountPrice+a.priceExtraCalc},a.calcExtra(),a.agentList=function(){e.agentList()},a.tenantList=function(){e.tenantList()},a.discountList=function(){e.discountList()},a.statusList=function(){e.statusList(m.getStatus(null,!0))},a.propertyList=function(){e.propertyList(a.data.checkin,a.data.checkout)},a.removeAgent=function(){a.data.agent={}},a.openCalendar=function(){return a.data.property.id?(a.options.calendarOpened=!0,void g(function(){$(".arrival").data("dateRangePicker").open(),$(".date-picker-wrapper").addClass("custom-datepicker-class")})):j.error({message:"Please select a property first"})},a.emailList=function(){e.emailList(a.data.id,a.data.emails,"",a.data.user.id)},d.$on("updateStatus",function(b,c){m.update(c.id,{status:c.status}).then(function(){a.data.status=c.status,j.success({message:"Status updated!"})})}),d.$on("propertySelected",function(b,c){f.destroy(),k.getDetails(c.unique).then(function(b){var d=b.data.bookings;f.loadCalendar(a.data.checkin,a.data.checkout,!1,d),a.fullPrice=b.data.price,g(function(){a.data.property=c,a.data.checkin&&a.data.checkout&&h.get(i.API_URL+"/getprice",{params:{property:a.data.property.id,checkin:a.data.checkin,checkout:a.data.checkout,format:i.DEFAULT_DATE_FORMAT}}).success(function(b){a.data.priceDay=b.price,a.data.nights=b.nights,a.data.utilitiesElectricity=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",a.data.utilitiesWater=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",b.nights<7?a.data.agentCommission=a.fullPrice.commissionDay:b.nights<30?a.data.agentCommission=a.fullPrice.commissionWeek:b.nights<365?a.data.agentCommission=a.fullPrice.commissionMonth:a.data.agentCommission=a.fullPrice.commissionYear})})})}),d.$on("agentSelected",function(b,c){a.data.agent=c}),d.$on("tenantSelected",function(b,c){a.data.user=c}),d.$on("discountSelected",function(b,c){a.discountPrice=a.data.nights*a.data.priceDay/100*a.data.discount.percent}),d.$on("statusSelected",function(b,c){a.data.status=c.value}),d.$on("datesChanged",function(b,c){a.options.calendarOpened&&g(function(){a.data.checkin=c.checkin,a.data.checkout=c.checkout,a.data.property.id&&h.get(i.API_URL+"/getprice",{params:{property:a.data.property.id,checkin:c.checkin,checkout:c.checkout,format:i.DEFAULT_DATE_FORMAT}}).success(function(b){a.data.priceDay=b.price,a.data.nights=b.nights,a.data.utilitiesElectricity=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",a.data.utilitiesWater=a.data.nights>6?"Paid by tenant at Check-out":"Paid by us",0==a.data.agentCommission&&"undefined"==typeof a.data.agentCommission&&(b.nights<7?a.data.agentCommission=a.fullPrice.commissionDay:b.nights<30?a.data.agentCommission=a.fullPrice.commissionWeek:b.nights<365?a.data.agentCommission=a.fullPrice.commissionMonth:a.data.agentCommission=a.fullPrice.commissionYear)})})}),a.getStatus=function(a){return m.getStatus(a)},a["delete"]=function(a){m["delete"](a).then(function(){j.success({message:"Booking Deleted !"}),b.go("management.home",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?j.error({message:JSON.stringify(a.data.errors)}):j.error({message:JSON.stringify(a.data)})})},a.update=function(){var c=0;a.data.rentpayday>0&&a.data.rentpayday<=31&&(parseInt(moment().utc().format("D"))<=parseInt(a.data.rentpayday)?(c=moment.utc(moment.utc().format("YYYY")+"-"+moment.utc().format("MM"),"YYYY-MM").format("YYYY-MM"),c=c+"-"+a.data.rentpayday,c=moment.utc(c,"YYYY-MM-D").unix()):(c=moment.utc(moment().utc().format("YYYY")+"-"+moment.utc().add(1,"month").format("MM"),"YYYY-MM").format("YYYY-MM"),c=c+"-"+a.data.rentpayday,c=moment.utc(c,"YYYY-MM-D").unix())),a.getFilledExtra=function(){return a.data.priceExtra.filter(function(a){return""!==a.calc&&""!=a.name&&""!=a.price})};var d={property:a.data.property.id,user:a.data.user.id,agent:a.data.agent.id?a.data.agent.id:"",agentCommission:a.data.agentCommission,discount:a.data.discount.id,discountPercentage:a.data.discount.percent,discountAmount:a.discountPrice,checkin:a.data.checkin?moment.utc(a.data.checkin,i.DEFAULT_DATE_FORMAT).startOf("day").unix():"",checkout:a.data.checkout?moment.utc(a.data.checkout,i.DEFAULT_DATE_FORMAT).startOf("day").unix():"",status:a.data.status,currency:a.data.currency,priceExtra:a.getFilledExtra(),paymentType:a.data.paymentType,priceDay:a.data.priceDay,created:moment.utc().unix(),utilitiesElectricity:a.data.utilitiesElectricity,utilitiesWater:a.data.utilitiesWater,utilitiesWifi:a.data.utilitiesWifi,utilitiesCable:a.data.utilitiesCable,rate:1,expires:a.data.expires,nights:a.data.nights,conditionsAgent:a.data.conditionsAgent,conditionsTenant:a.data.conditionsTenant,pricePaid:a.data.pricePaid,priceReservation:a.data.priceReservation,priceSecurity:a.data.priceSecurity,emails:a.data.emails,rentpayday:a.data.rentpayday,nextpayment:c,comment:a.data.comment,source:a.data.source,arrival:a.data.arrival,electricPrice:a.data.property.electricUnit*(a.data.electricTo-a.data.electricFrom),electricFrom:a.data.electricFrom,waterFrom:a.data.waterFrom,waterTo:a.data.waterTo,waterPrice:a.data.property.waterUnit*(a.data.waterTo-a.data.waterFrom),electricTo:a.data.electricTo,departure:a.data.departure};m.update(a.data.id,d).then(function(){j.success({message:"Booking Updated !"}),b.go("management.home",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?j.error({message:JSON.stringify(a.data.errors)}):j.error({message:JSON.stringify(a.data)})})},c.check&&m.update(a.data.id,{checked:!0})}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.profile",{url:"profile/",css:["/css/admin.css"],controller:"ManagerProfileCtrl",title:"title_management_profile",templateProvider:function(a){return a.get("templates/management/profile/index.html")}})}]).controller("ManagerProfileCtrl",["User","$stateParams","$scope","$state","$rootScope","Notification",function(a,b,c,d,e,f){c._signature=e.admin.signature,c.update=function(){var b={signature:c._signature};a.update(e.admin.id,b).then(function(){f.success({message:"Signature Updated !"}),d.go("management.profile",{},{reload:!0})})["catch"](function(a){a.data&&a.data.errors?f.error({message:JSON.stringify(a.data.errors)}):f.error({message:JSON.stringify(a.data)})})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.properties",{url:"properties/",css:["/css/admin.css"],controller:"ManagerPropertiesCtrl",title:"title_management_properties",templateProvider:function(a){return a.get("templates/management/properties/index.html")},resolve:{Results:["Locale","$http","$q","CONFIG","$rootScope","$stateParams",function(a,b,c,d,e,f){var g=c.defer(),h=a.getDates(!0);return b.get(d.API_URL+"/search-booking",{params:{checkin:h.checkin,checkout:h.checkout,format:d.DEFAULT_DATE_FORMAT,language:e.language,location:0,searchonly:f.searchonly}}).then(function(a){g.resolve(a.data)}),g.promise}]}})}]).controller("ManagerPropertiesCtrl",["Results","Calendar","$stateParams","$scope","$state","$rootScope",function(a,b,c,d,e,f){b.loadCalendar(),d.datesChangedCount=0,d.nights=b.nights(),d.prices=a.prices,d.defaultPrices=a.defaultPrices,d.properties=a.free,d.bookedproperties=a.booked,d.whenFree=a.whenFree,f.$on("datesChanged",function(a,b){d.checkin=b.checkin,d.checkout=b.checkout}),d.search=function(){e.go("management.properties",{},{reload:!0})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("management.property",{url:"property/:id/",title:"title_property",css:"/css/admin.css",templateProvider:function(a){return a.get("templates/management/property/index.html")},controller:"ManagementPropertyCtrl",resolve:{PropertyData:["Property","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}})}]).controller("ManagementPropertyCtrl",["PropertyData","$timeout","$scope","$state","Calendar","Modal",function(a,b,c,d,e,f){e.loadCalendar(!1,!1,!1,a.data.bookings),c.property=a.data.property,c.translation=a.data.translation,c.price=a.data.price,c.agentrentlink=d.href("agent.property",{id:c.property.unique},{absolute:!0}),c.booked=a.data.booked,c.rentlink=d.href("property",{id:c.property.unique},{absolute:!0}),c.salelink=d.href("sale",{id:c.property.unique},{absolute:!0}),c.openCalendar=function(){b(function(){$(".arrival, .departure").data("dateRangePicker").open()})},c.propertyDetails=function(){f.propertyDetails(c.property,c.translation,!0)}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("about",{url:"/about/",title:"title_about",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/about/index.html")},controller:"AboutCtrl",resolve:{Ratings:["$q","Rating",function(a,b){var c=a.defer();return b.getRatings().then(function(a){c.resolve(a)}),c.promise}]}})}]).controller("AboutCtrl",["$scope","Ratings",function(a,b){a.ratings=b.data,a.nrRatings=5,a.moreReviews=function(){a.nrRatings+=5}}])}(),function(){"use strict";angular.module("ThaiHome").controller("AuthCtrl",["$scope","Auth",function(a,b){a.credentials={email:"",password:""},a.login=function(){b.login(a.credentials)}}]).factory("Auth",["$http","User","CONFIG","$q","$rootScope","Email","$timeout","dpd",function(a,b,c,d,e,f,g,h){function i(b){var e=d.defer();return a.get(c.API_URL+"/users",{params:{token:b}}).then(function(a){a.data.length?e.resolve(a.data[0]):e.reject()})["catch"](function(){e.reject()}),e.promise}function j(f,g){var h=d.defer();return a.post(c.API_URL+"/users/login",{username:f.toLowerCase(),password:g}).then(function(a){return a}).then(function(a){return b.getDetails(a.data.uid)}).then(function(b){var d=n();return localStorage.setItem("auth",d),localStorage.removeItem("agent"),b.auth=d,a.post(c.API_URL+"/users",b)}).then(function(a){"agent"===a.data.type?(e.agent=a.data,h.resolve(a.data)):(m(),h.reject())})["catch"](function(a){h.reject(a)}),h.promise}function k(f,g){var h=d.defer();return a.post(c.API_URL+"/users/login",{username:f.toLowerCase(),password:g}).then(function(a){return a}).then(function(a){return b.getDetails(a.data.uid)}).then(function(b){var d=n();return localStorage.setItem("auth",d),b.auth=d,a.post(c.API_URL+"/users",b)}).then(function(a){"admin"===a.data.type||"translator"===a.data.type?(e.admin=a.data,h.resolve(a.data)):(m(),h.reject())})["catch"](function(a){h.reject(a)}),h.promise}function l(a){var c=d.defer();return b.getDetails(!1,a).then(function(a){if("tenant"!==a.type){for(var b="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=0;40>e;e++)b+=d.charAt(Math.floor(Math.random()*d.length));return a.token=b,a}c.reject()}).then(function(a){return b.update(a.id,a)}).then(function(a){var b={to:a.email,token:a.token,language:e.language,subject:"Your password reset request"};return f.send("forgot_password",b)}).then(function(){c.resolve()})["catch"](function(a){c.reject()}),c.promise}function m(){var b=d.defer();return localStorage.removeItem("auth"),a.post(c.API_URL+"/users/logout").then(function(a){e.agent=!1,e.admin=!1,b.resolve(a)})["catch"](function(a){b.reject(a)}),b.promise}function n(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;20>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function o(){var b=d.defer(),f=localStorage.getItem("auth");return null!=f?a.get(c.API_URL+"/users",{params:{auth:f}}).then(function(a,c){a.data.length?("agent"===a.data[0].type?e.agent=a.data[0]:"admin"===a.data[0].type&&(e.admin=a.data[0]),b.resolve({data:a.data[0]})):b.resolve({data:{}})}):h.users.get("me",function(a,c){a&&_.isObject(a)?("agent"===a.type?e.agent=a:"admin"===a.type&&(e.admin=a),b.resolve({data:a})):b.resolve({data:{}})}),b.promise}return{loginAgent:j,logout:m,checkLogged:o,forgotPassword:l,checkToken:i,loginAdmin:k,genToken:n}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("autologin",{url:"/autologin/:email/",template:"",resolve:{login:["User","$q","$stateParams","$state","$timeout",function(a,b,c,d,e){var f=b.defer();return localStorage.removeItem("auth"),a.getOne(atob(c.email)).then(function(a){f.resolve(a),e(function(){d.go("contact")},1500)})["catch"](function(){d.go("home"),f.resolve()}),f.promise}]}})}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("book",{url:"/book/:id/:discount/:agent/",title:"title_book",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/book/index.html")},controller:"BookCtrl",resolve:{check:["Booking","Locale","$q","$stateParams","$state","$location",function(a,b,c,d,e,f){var g=c.defer();return a.check(d.id).then(function(a){a?g.reject():g.resolve()}),g.promise}],Location:["$q","IPLocation",function(a,b){var c=a.defer();return b.get().then(function(a){c.resolve(a)})["catch"](function(){c.resolve(null)}),c.promise}],Agent:["$q","User","Locale",function(a,b,c){var d=a.defer();return c.getAgent()?b.getDetails(c.getAgent()).then(function(a){"agent"===a.type?d.resolve(a):d.resolve(!1)})["catch"](function(){d.resolve(!1)}):d.resolve(!1),d.promise}],currentUser:["Auth","$q",function(a,b){var c=b.defer();return a.checkLogged().then(function(a){c.resolve(a)})["catch"](function(){c.resolve({})}),c.promise}],Dates:["$q","Locale","$state","$location",function(a,b,c,d){var e=a.defer(),f=b.getDates();return f.valid?e.resolve(f):localStorage.getItem("past-booking-id")&&""!=localStorage.getItem("past-booking-id")?(d.path("/booking/"+localStorage.getItem("past-booking-id")+"/"),e.resolve({})):e.reject(),e.promise}],PropertyData:["Property","$q","$stateParams","$http","CONFIG","Locale",function(a,b,c,d,e,f){var g=b.defer();return a.getDetails(c.id).then(function(a){var b=a.data,c=f.getDates();d.get(e.API_URL+"/getprice",{params:{property:b.property.id,checkin:c.checkin,checkout:c.checkout,format:e.DEFAULT_DATE_FORMAT}}).success(function(a){g.resolve({price:a,property:b})})})["catch"](function(a){g.reject(a,404)}),g.promise}],Ratings:["Rating","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getPropertyRatings(c.id).then(function(a){d.resolve(a)}),d.promise}],Message:["Contact","$q","Auth",function(a,b,c){var d=b.defer();return c.checkLogged().then(function(b){a.getMessage(null,b.data.id,null).then(function(a){d.resolve(a)})["catch"](function(){d.resolve({data:[]})})}),d.promise}],CountriesList:["Countries",function(a){return a.list}]}}).state("booking",{url:"/booking/:id/:action/",title:"title_book",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/booking/index.html")},controller:"BookingCtrl",params:{sendPaymentPending:!1,action:{squash:!0}},resolve:{BookingData:["Booking","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}],Email:["Email","$stateParams","$rootScope","$q",function(a,b,c,d){var e=d.defer();return b.sendPaymentPending?a.send("payment_payment_bank",{booking:b.id,preview:!1,subject:c.T.email_subject_payment_pending,language:c.language}).then(function(){e.resolve()})["catch"](e.resolve):e.resolve(),e.promise}],Status:["$stateParams","$q","Booking",function(a,b,c){var d=b.defer();return a.sendPaymentPending?c.update(a.id,{status:1}).then(d.resolve)["catch"](d.resolve):d.resolve(),d.promise}]}})}]).factory("Booking",["dpd","$http","User","$q","CONFIG","Locale","Property","Modal",function(a,b,c,d,e,f,g,h){function i(b,c,i){var j=d.defer();return g.getDetails(b).then(function(b){var c=i||f.getDates(),d=moment(c.checkin,e.DEFAULT_DATE_FORMAT).add(6,"hours").unix(),g=moment(c.checkout,e.DEFAULT_DATE_FORMAT).unix();return a.booking.get({property:b.data.property.id,checkin:{$lte:moment.unix(g).utc().unix()},checkout:{$gt:moment.unix(d).utc().unix()},$limit:1})}).then(function(a){a.data.length?(c?h.doubleBookingAgent(a.data[0]):h.doubleBooking(a.data[0]),j.reject(a.data[0])):j.resolve(!1)})["catch"](function(a){j.reject(a,404)}),j.promise}function j(a,b){var c=[{value:0,name:"[T] ThaiHome"},{value:1,name:"[B] Booking.com"},{value:2,name:"[A] AirBnB"},{value:3,name:"[O] Ostravok"},{value:4,name:"[E] Expedia"}];return b?c:_.findWhere(c,{value:a})}function k(a){var c=d.defer();return a?b.get(e.API_URL+"/booking/"+a,{params:{language:localStorage.getItem("locale")}}).then(function(a){c.resolve(a)},function(a){c.reject(a)}):c.reject(),c.promise}function l(){var a=d.defer();return b.get(e.API_URL+"/getbookings/").then(function(b){a.resolve(b)},function(){a.resolve({data:[]})}),a.promise}function m(a){var c=d.defer();return b.get(e.API_URL+"/getbookingsold/",{params:a}).then(function(a){c.resolve(a)},function(){c.resolve({data:[]})}),c.promise}function n(b){var c=d.defer();return a.booking.get(b).then(function(a){c.resolve(a)},function(){c.resolve({data:[]})}),c.promise}function o(a,c){var f=d.defer();return b.put(e.API_URL+"/booking/"+a,c).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise}function p(a){var c=d.defer();return b["delete"](e.API_URL+"/booking/"+a).then(function(a){c.resolve(a)})["catch"](function(a){c.reject(a)}),c.promise}function q(a){var c=d.defer();return b.post(e.API_URL+"/deleteall",a).then(function(a){c.resolve(a)})["catch"](function(a){c.reject(a)}),c.promise}function r(a){var f=a,g=d.defer();return c.getOne(a.user.email,a.user,!0).then(function(a){return a}).then(function(a){return f.agent=a.agent?a.agent:"",f.user=a.id,b.post(e.API_URL+"/booking",f)}).then(function(a){g.resolve(a)})["catch"](function(a){g.reject(a)}),g.promise}function s(a,b){var c=[{value:0,name:"New Booking"},{value:1,name:"Pending"},{value:3,name:"Booked"},{value:4,name:"Check-in"},{value:5,name:"Check-out"},{value:6,name:"Done"},{value:7,name:"Cancelled"}];return b?c:_.findWhere(c,{value:a})}return{getStatus:s,getSources:j,newBooking:r,find:n,check:i,getDetails:k,update:o,"delete":p,deleteAll:q,findManagement:l,findManagementOld:m}}]).controller("BookingCtrl",["BookingData","Payment","Contact","Modal","gMaps","$scope","CONFIG","$compile","$rootScope","$state","Booking","Notification","$stateParams","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){f.showLastChat=function(){n(function(){jQuery(".smaller-chat").scrollTop(jQuery(".smaller-chat")[0].scrollHeight)},1e3)},localStorage.removeItem("past-booking-id"),f.chatdisabled=!1,f.data=a.data,f.isBooking=!0,f.data.checkin=moment.unix(a.data.checkin).utc().format(g.DEFAULT_DATE_FORMAT),f.data.checkout=moment.unix(a.data.checkout).utc().format(g.DEFAULT_DATE_FORMAT),f.saveDates=function(){k.update(f.data.id,{arrival:f.data.arrival,departure:f.data.departure}).then(function(){f.contact.message="I set my Arrival Time to: "+f.data.arrival+"\n\nI set my Departure Time to: "+f.data.departure,c.askQuestion(f.contact,!1,!1,f.data.id).then(function(a){f.messages=a,f.contact.message="",f.chatdisabled=!1,l.success({message:"Arrival/Departure dates updated!"})})})},f.changeDates=function(){jQuery("form[name=contact-form] textarea").val("Hi, I would like to change my booking dates to:").focus(),jQuery("html, body").animate({scrollTop:jQuery("chat").offset().top-66},2e3)},f.steps=[{templateUrl:"templates/payment/steps/final.html",hasForm:!0,title:"Update validity"}],f.voucherLink=j.href("voucher",{id:f.data.id},{absolute:!0}),i.agent?f.contact={name:i.agent.name,email:i.agent.email}:void 0!=a.data.user?f.contact={name:a.data.user.name,email:a.data.user.email}:f.contact={},f.priceExtra=0,_.map(f.data.priceExtra,function(a){f.priceExtra+=parseInt(a.price)}),f.paymentMethods=b.methods(),f.selectPayment=function(a){var b=_.findWhere(f.paymentMethods,{id:parseInt(a)}),c=b.directive,d=f.data.cleanfinalprice+(f.data.priceDay*f.data.nights-f.data.priceDay*f.data.nights/100*f.data.discountPercentage)+f.priceExtra;n(function(){var a=h("<payment-"+c+' rate="'+f.data.rate+'" language="'+i.language+'" currency="'+f.data.currency.currency+'" amount="'+d+'" bookingid="'+f.data.id+'"></payment-'+c+">")(f);$("#payment_placeholder").html(a)},1e3)},f.translation=a.data.translation,f.property=a.data.property,void 0!=a.data.messages?(a.data.messages.messages=_.sortBy(a.data.messages.messages,"date"),f.messages=a.data.messages,n(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight)},500)):f.messages=[],f.$on("mapInitialized",function(a,b){var g={address2:f.property.address2,address3:f.property.address3,name:f.property.name,featured:f.property.featured,unique:f.property.unique,gmapsdata:f.property.gmapsdata};e.propertyMap(b,g),f.openGallery=function(){d.openGallery(f.property.images,f.property.unique)},f.rules=function(){d.rules(f.translation)},f.cancellation=function(){d.cancellation()},f.askQuestion=function(){f.chatdisabled=!0,c.askQuestion(f.contact,!1,!1,f.data.id).then(function(a){f.messages=a,d.messageReceived(),f.contact.message="",f.chatdisabled=!1})},"contact"===m.action?($("html,body").animate({scrollTop:$("chat").offset().top-65}),$("#txtChat").focus()):"watch"===m.action?f.openGallery():"rules"===m.action?f.rules():"cancel"===m.action&&f.cancellation()})}]).controller("BookCtrl",["CountriesList","Booking","Locale","Discount","Modal","currentUser","Message","$http","$scope","PropertyData","Rating","Contact","$rootScope","CONFIG","gMaps","$stateParams","Dates","Email","Agent","Payment","$compile","Location","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){i.paymentMethods=t.methods(),i.selectPayment=function(a){i.paymentType=parseInt(a);var b=_.findWhere(i.paymentMethods,{id:parseInt(a)}),c=b.directive,d=i.property.cleanfinalprice+(i.priceDay*i.nights-i.priceDay*i.nights/100*i.discount.percent);w(function(){var a=u("<payment-"+c+' rate="1" language="'+m.language+'" currency="'+n.DEFAULT_CURRENCY+'" amount="'+d+'" bookingid="'+i.bookingID+'"></payment-'+c+">")(i);$("#payment_placeholder").html(a)},1e3)},i.property=j.property.property,i.translation=j.property.translation,i.price=j.property.price,i.nights=j.price.nights,i.priceDay=j.price.price,i.countries=a,i.refAgent=s,_.isEmpty(f.data)?i.contact={}:(i.contact={},i.contact.name=f.data.name,i.contact.email=f.data.email,i.contact.message="",i.contact.country=f.data.country,i.contact.phone=f.data.phone);var x=localStorage.getItem("past-booking-country");null!==x?i.contact.country=x:i.contact.country=v&&v.data&&v.data.country||null,_.isEmpty(g.data)?i.messages={}:i.messages=g.data[0],p.discount?d.getDiscount(p.discount,f.data.id,i.property.id).then(function(a){a.length?i.discount=a[0]:i.discount={percent:0}}):i.discount={percent:0},i.askQuestion=function(){if(i.messages.id){var a={date:moment().unix(),manager:!1,message:i.contact.message,property:p.id};i.messages.read=!1,i.messages.messages.push(a)}else{var b={read:!1,messages:[{manager:!1,date:moment().unix(),message:i.contact.message,property:p.id}]};i.messages=b}l.askQuestion(i.contact.name,i.contact.email,i.messages),e.messageReceived(),i.contact.message=""},i.getDay=function(a){return l.getDay(a)},i.openGallery=function(){e.openGallery(i.property.images,i.property.unique)},i.propertyDetails=function(){e.propertyDetails(i.property,i.translation)},i.rules=function(){e.rules(i.translation)},i.cancellation=function(){e.cancellation()},i.checkin=q.checkin,i.checkout=q.checkout,i.steps=[{templateUrl:"templates/payment/steps/first.html",title:"Introduction",hasForm:!0},{templateUrl:"templates/payment/steps/final.html",hasForm:!0,title:"Update validity"}],i.book=function(){var a={property:i.property.id,user:{email:i.contact.email,name:i.contact.name,country:i.contact.country,phone:i.contact.phone,agent:i.refAgent?i.refAgent.id:""},agent:i.refAgent?i.refAgent.id:"",agentCommission:i.agent_commission,discount:i.discount.id,discountPercentage:i.discount.percent,checkin:moment.utc(i.checkin,n.DEFAULT_DATE_FORMAT).startOf("day").unix(),checkout:moment.utc(i.checkout,n.DEFAULT_DATE_FORMAT).startOf("day").unix(),status:0,currency:_.findWhere(m.currencies,{currency:localStorage.getItem("currency")}).id,priceDay:i.priceDay,created:moment().utc().unix(),utilitiesElectricity:i.nights>6?"Paid by tenant at Check-out":"Paid by us",utilitiesWater:i.nights>6?"Paid by tenant at Check-out":"Paid by us",utilitiesWifi:"Included",utilitiesCable:"Included BTV",rate:1,cleanfinalprice:i.property.cleanfinalprice,cleanprice:i.property.cleanprice,expires:moment().utc().add(n.BOOKING_DAYS_EXPIRE,"day").unix(),nights:i.nights,pricePaid:0,emails:[],priceReservation:0,source:0};b.newBooking(a).then(function(a){localStorage.setItem("past-booking-country",i.contact.country),localStorage.setItem("past-booking-id",a.data.id),c.deleteDates();var b={booking:a.data.id,subject:"Your booking at "+i.property.name,language:m.language};r.send("booking_confirmation",b),i.bookingID=a.data.id})}}])}(),function(){"use strict";angular.module("ThaiHome").directive("bookingCalendar",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/thaihome/booking-dates/index.html")}}}]).factory("Calendar",["Locale","CONFIG","$timeout","$rootScope",function(a,b,c,d){return{nights:function(){var c=a.getDates(),d=c.checkin,e=moment(c.checkout,b.DEFAULT_DATE_FORMAT),f=moment(e,b.DEFAULT_DATE_FORMAT).diff(d,"days");return f},destroy:function(){try{$(".arrival, .departure").data("dateRangePicker").destroy()}catch(a){}},loadCalendar:function(e,f,g,h){function i(a){var b=moment.utc(parseInt(a.getTime()/1e3),"X").add("0","day").format("X");if(h)for(var c=0;c<h.length;c++)if(b>=h[c].checkin&&b<=h[c].checkout)return!1;return!0}function j(a){a===!1?$(".arrival, .departure").removeClass("highlight"):$(a).addClass("highlight")}function k(a){$("#checkinval").html(moment(a.date1).format(b.DEFAULT_DATE_FORMAT))}if(a.validateDates(e,f)===!1)if(e=!1,f=!1,g===!0){var l=a.getDefaultDates();e=l.checkin,f=l.checkout}else{var m=a.getDates();m.valid===!0&&(e=m.checkin,f=m.checkout)}var n={showShortcuts:!1,separator:" to ",minDays:1,minDate:new Date,singleMonth:$(window).width()<400?!0:!1,
stickyMonths:$(window).width()<400?!1:!0,getValue:function(){return $("#arrival").val()&&$("#departure").val()?$("#arrival").val()+" to "+$("#departure").val():""},setValue:function(b,c,e){j(!1),$("#checkinval").html(c),$("#checkoutval").html(e),a.setDates(c,e),d.$broadcast("datesChanged",{checkin:c,checkout:e})},selectForward:!0,customTopBar:'<span class="calendar_current_selection"></span>',beforeShowDay:function(a){var b=!((new Date).getTime()-a>=864e5),c="",d="";return h&&(i(a)||(b=!1,d="Already Booked")),[b,c,d]},autoClose:!0,format:b.DEFAULT_DATE_FORMAT};$(document).ready(function(){$(document).click(function(a){($(a.target).hasClass("book")||$(a.target).parent().hasClass("book"))&&$(".date-picker-wrapper").is(":visible")&&(a.preventDefault(),a.stopImmediatePropagation())}),$(".departure").click(function(a){$(".arrival").click(),a.preventDefault(),a.stopImmediatePropagation()}),$(".arrival").removeClass("highlight"),c(function(){e&&f?$(".arrival, .departure").dateRangePicker(n).bind("datepicker-open",function(){$(".calendar_current_selection").html('CHOOSE <span class="calendar_text_border">CHECK-IN DATE</span>'),j(".arrival")}).bind("datepicker-first-date-selected",function(a,b){$(".calendar_current_selection").html('CHOOSE <span class="calendar_text_border">CHECK-OUT DATE</span>'),$(".arrival").removeClass("highlight"),j(".departure"),$("#checkoutval").html("Check-out")}).data("dateRangePicker").setDateRange(e,f):$(".arrival, .departure").dateRangePicker(n).bind("datepicker-open",function(){$(".calendar_current_selection").html('CHOOSE <span class="calendar_text_border">CHECK-IN DATE</span>'),j(".arrival")}).bind("datepicker-first-date-selected",function(a,b){$(".calendar_current_selection").html('CHOOSE <span class="calendar_text_border">CHECK-OUT DATE</span>'),$(".arrival").removeClass("highlight"),j(".departure"),$("#checkoutval").html("Check-out"),k(b)})}),$(".departure").removeClass("highlight")})},doubleDates:function(a,e,f,g,h){var i={showShortcuts:!1,separator:" to ",minDays:1,setValue:function(a,b,c){d.$broadcast(e,{date1:b,date2:c})},autoClose:!0,format:h?h:b.DEFAULT_DATE_FORMAT};$(document).ready(function(){c(function(){f&&g?$(a).dateRangePicker(i).data("dateRangePicker").setDateRange(f,g):$(a).dateRangePicker(i)})})},singleDate:function(a,e,f){var g={showShortcuts:!1,autoClose:!0,singleDate:!0,format:b.DEFAULT_DATE_FORMAT,setValue:function(a){d.$broadcast(e,moment(a,b.DEFAULT_DATE_FORMAT).unix())}};$(document).ready(function(){c(function(){if(f){var c=moment.unix(f).format(b.DEFAULT_DATE_FORMAT);$(a).dateRangePicker(g).data("dateRangePicker").setDateRange(c,c)}else $(a).dateRangePicker(g)})})}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("CONFIG",["ENV",function(a){var b=a;return b}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("contact",{url:"/contact/",title:"title_contact",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/contact/index.html")},controller:"ContactCtrl",resolve:{currentUser:["Auth","$q",function(a,b){var c=b.defer();return a.checkLogged().then(function(a){c.resolve(a)})["catch"](function(){c.resolve()}),c.promise}],Message:["Contact","$q","Auth",function(a,b,c){var d=b.defer();return c.checkLogged().then(function(b){return a.getMessage(null,b.data.id,null)}).then(function(a){d.resolve(a)}),d.promise}]}})}]).controller("ContactCtrl",["Contact","Auth","Modal","$http","$scope","$rootScope","CONFIG","currentUser","Message","$timeout",function(a,b,c,d,e,f,g,h,i,j){e.chatdisabled=!1,e.focusChat=function(){j(function(){jQuery("form[name=contact-form] textarea").focus(),jQuery("form[name=contact-form] input[value='']:not(:checkbox,:button):visible:first").focus()},500)},h.data?(e.contact={},e.contact.name=h.data.name,e.contact.email=h.data.email,e.contact.message=""):e.contact={},_.isEmpty(i)?e.messages={}:e.messages=i,e.getDay=function(b){return a.getDay(b)},e.askQuestion=function(){e.chatdisabled=!0,a.askQuestion(e.contact).then(function(a){e.messages=a,c.messageReceived(),e.contact.message="",e.chatdisabled=!1})}}]).factory("Contact",["$q","$http","CONFIG","User","Notification","$timeout","$rootScope",function(a,b,c,d,e,f,g){function h(d,e,g){var h,i=a.defer(),j={};return d?j.id=d:e?j.user=e:g?j.user=g:i.resolve({}),b.get(c.API_URL+"/getmessage",{params:j}).then(function(a){if(a.data){h=a.data;var b=_.sortBy(h.messages,"date");h.messages=b}else h={};f(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight)},1e3),i.resolve(h)})["catch"](function(){i.resolve({})}),i.promise}function i(a){return moment(a,"X").format("YYYY-MM-DD")}function j(b){var c=a.defer(),d=_.after(b.messages.length,function(){var a;a=b,a.messages=e,c.resolve(a)}),e=[];return _.each(b.messages,function(a){_.isObject(a.booking)&&(a.booking=a.booking.id),_.isObject(a.property)&&(a.property=a.property.id),e.push(a),d()}),c.promise}function k(d,h){$("#contact_submit_button").prop("disabled",!0),e.info({message:"<span>Posting your message...</span>",delay:2e3}),f(function(){$("body .ui-notification").addClass("notification_message")},100);var i=a.defer(),j={message:h,date:moment().unix(),manager:!0,property:null,booking:null};d.read=!0,d.messages.push(j),b.post(c.API_URL+"/message/",d).then(function(a){$("#contact_submit_button").prop("disabled",!1),f(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight),$("chat textarea:first").focus()},1e3),i.resolve(a.data)});var k="",l="";_.each(d.messages,function(a){void 0!==a.booking&&null!==a.booking&&void 0!==a.booking.id&&null!==a.booking.id&&(k=a.booking.id),void 0!==a.property&&null!==a.property&&void 0!==a.property.unique&&null!==a.property.unique&&(l=a.property.unique)});var m={language:g.language,message:d.id,property:l,booking:k},n=0;return _.each(d.messages,function(a){a.manager&&n++}),1==n&&f(function(){b.get(c.API_URL+/email/,{params:m}),b.put(c.API_URL+"/users/"+d.user.id,{lastMessengerMail:Date.now()})},1500),i.promise}function l(i,k,l,m){$("#contact_submit_button").prop("disabled",!0),e.info({message:"<span>Posting your message...</span>",delay:2e3}),f(function(){$("body .ui-notification").addClass("notification_message")},100);var n,o=a.defer(),p={message:i.message,date:moment().unix(),manager:k?!0:!1,property:l?l:null,booking:m?m:null},q={name:i.name,email:i.email};return d.getOne(i.email,q).then(function(a){return n=a,a}).then(function(){return g.agent?!0:d.autoLoginTenant(i.email)}).then(function(){return h(null,n,null).then(function(a){if(a.id){var d=a;d.read=!1,d.messages.push(p),j(d).then(function(a){return b.put(c.API_URL+"/message/"+a.id,a)}).then(function(){return h(null,n,null)}).then(function(a){$("#contact_submit_button").prop("disabled",!1),f(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight),$("chat textarea:first").focus()},1e3),o.resolve(a)})}else{var e={read:!1,user:n,messages:[p]};j(e).then(function(){return b.post(c.API_URL+"/message/",e)}).then(function(){return h(null,n,null)}).then(function(a){$("#contact_submit_button").prop("disabled",!1),o.resolve(a)})}})}),o.promise}function m(d){var e=a.defer();return b.get(c.API_URL+"/getmessage",{params:{$skip:d.skip||0,$limit:d.limit||25,$sort:d.sort||{}}}).then(function(a){e.resolve(a.data)})["catch"](function(){e.resolve([])}),e.promise}function n(){var d=a.defer();return b.get(c.API_URL+"/message/count",{params:{read:!1}}).then(function(a){d.resolve(a.data.count)})["catch"](function(){d.resolve([])}),d.promise}function o(d){var e=a.defer();return b.post(c.API_URL+"/deleteall",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise}function p(d){var e=a.defer();return b["delete"](c.API_URL+"/message/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise}function q(){var d=a.defer();return b.get(c.API_URL+"/message",{}).then(function(a){d.resolve(a.data)})["catch"](function(){d.resolve([])}),d.promise}function r(a){var b=_.sortBy(a.messages,"date"),c=_.findLastIndex(b,{manager:!1});return b[c]}function s(a){return b.put(c.API_URL+"/message/"+a,{read:!0})}return{getMessage:h,getAllMessages:q,askQuestion:l,cleanMessages:j,getDay:i,getUnread:m,replyQuestion:k,getUnreadCount:n,latestUnread:r,deleteAllMessage:o,"delete":p,readMessage:s}}]).directive("chat",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/thaihome/contact/chat.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Countries",[function(){var a=["Afghanistan","Albania","Algeria","American Samoa","Andorra","Angola","Anguilla","Antarctica","Antigua and Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bonaire, Sint Eustatius and Saba","Bosnia and Herzegovina","Botswana","Bouvet Island","Brazil","British Indian Ocean Territory","Brunei Darussalam","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Cayman Islands","Central African Republic","Chad","Chile","China","Christmas Island","Cocos (Keeling) Islands","Colombia","Comoros","Congo","Congo, The Democratic Republic of the","Cook Islands","Costa Rica","CÃ´te d'Ivoire","Croatia","Cuba","CuraÃ§ao","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Falkland Islands (Malvinas)","Faroe Islands","Fiji","Finland","France","French Guiana","French Polynesia","French Southern Territories","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guernsey","Guinea","Guinea-Bissau","Guyana","Haiti","Heard Island and McDonald Islands","Holy See (Vatican City State)","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran, Islamic Republic of","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Korea, Democratic People's Republic of","Korea, Republic of","Kuwait","Kyrgyzstan","Lao People's Democratic Republic","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macao","Macedonia, Republic Of","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mexico","Micronesia, Federated States of","Moldova, Republic of","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","Northern Mariana Islands","Norway","Oman","Pakistan","Palau","Palestine, State of","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Pitcairn","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russian Federation","Rwanda","Saint BarthÃ©lemy","Saint Helena, Ascension and Tristan da Cunha","Saint Kitts and Nevis","Saint Lucia","Saint Martin (French Part)","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Sint Maarten (Dutch Part)","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Georgia and the South Sandwich Islands","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Svalbard and Jan Mayen","Swaziland","Sweden","Switzerland","Syrian Arab Republic","Taiwan","Tajikistan","Tanzania, United Republic of","Thailand","Timor-Leste","Togo","Tokelau","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Turks and Caicos Islands","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","United States Minor Outlying Islands","Uruguay","Uzbekistan","Vanuatu","Venezuela","Viet Nam","Virgin Islands, British","Virgin Islands, U.S.","Wallis and Futuna","Western Sahara","Yemen","Zambia","Zimbabwe"];return{list:a}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Currency",["$http","CONFIG","$q",function(a,b,c){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/currency",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/currency",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/currency/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/currency/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/currency/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Discount",["CONFIG","User","$q","dpd","$http",function(a,b,c,d,e){return{getDiscount:function(a,b,e){var f=c.defer();return d.discount.get({$or:[{user:b,property:e,code:a},{property:null,user:b,code:a},{user:null,property:e,code:a},{user:null,property:null,code:a}],$limit:1}).success(function(a){f.resolve(a)}),f.promise},find:function(a){var b=c.defer();return d.discount.get(a).then(function(a){a.data.length?b.resolve(a.data[0]):b.resolve({})}),b.promise},findAll:function(a){var b=c.defer();return d.discount.get(a).then(function(a){a.data.length?b.resolve(a.data):b.resolve({})}),b.promise},generate:function(a,e){var f=c.defer();return b.getOne(a,{},!0).then(function(a){return a}).then(function(a){var b={expires:moment().add(1,"year").unix(),promotion:"Rating Generated",percent:5,user:a.id,code:a.name.split(" ")[0]+""+e.slice(-3).toString(),note:"Booking "+e,booking:e};d.discount.post(b).success(function(a){f.resolve(a)})}),f.promise},getAll:function(b){var d=c.defer();return e.get(a.API_URL+"/discount",{params:b}).then(function(a){d.resolve(a.data)})["catch"](function(a){d.reject(a)}),d.promise},add:function(b){var d=c.defer();return e.post(a.API_URL+"/discount",b).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a)}),d.promise},update:function(b,d){var f=c.defer();return e.put(a.API_URL+"/discount/"+b,d).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(b){var d=c.defer();return e["delete"](a.API_URL+"/discount/"+b).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a)}),d.promise},getDetails:function(b){var d=c.defer();return e.get(a.API_URL+"/discount/",{params:{details:!0,id:b}}).then(function(a){return _.isObject(a.data)&&a.data.id?d.resolve(a.data):a.data.length?d.resolve(a.data[0]):d.reject(),d.promise}),d.promise}}}]).directive("discount",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/thaihome/discount/index.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Email",["CONFIG","$http","$q","$templateCache","$rootScope",function(a,b,c,d,e){return{send:function(d,e){var f=c.defer();return b.post(a.API_URL+"/email/"+d,e).then(function(a){e.preview?f.resolve(a.data):"sent"===a.data.status?f.resolve(!0):f.reject(a)}),f.promise},list:function(){var d=c.defer();return b.get(a.API_URL+"/emails").then(function(a){d.resolve(a.data)}),d.promise},getHTML:function(d){var e=c.defer();return b.post(a.API_URL+"/email/"+d,params).then(function(a){params.preview?e.resolve(a.data):"sent"===a.data.status?e.resolve(!0):e.reject(a)}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").directive("footer",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/thaihome/footer/index.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").service("gMaps",["_","$rootScope","$filter",function(a,b,c){this.loadMap=function(){var a;google.maps.event.addDomListener(window,"load",function(){var b=new google.maps.LatLng(12.919012,100.90433);a=new google.maps.Map($("#map-canvas"),{center:b,zoom:13})})},this.propertyMap=function(a,b){var c=new google.maps.LatLng(b.gmapsdata.split(",")[0],b.gmapsdata.split(",")[1]);a.setCenter(c),a.setZoom(15),a.setOptions({scrollwheel:!1});var d=b.name,e='<style>hr{margin:10px 0;} .map-img-container h3 {margin-bottom:10px;}.address{font-size:10px}h2{font-size:16px;margin: 0;}h3,p{margin:0}h3{font-size:14px}h3,h4{color:#537cb4;margin-bottom:0}hr{border:none;border-bottom:1px solid #DADADA}.clear{clear:both}.booked,.free{float:left;clear:left;}.free{color:green}.booked{color:red}.map-attachment{width:210px;position:relative;padding-right:15px;overflow:hidden}.price,.score{float:left}.score{margin-top:0;margin-right:10px;font-size:12px;}.map-btn:focus{outline:0}.map-img-container{float:left;margin-right:15px;}.map-text-container{float:right;width:98px;}.map-text-container .price b{color:green;font-size:13px;}.price{clear:left;float:left;margin:0}</style><div class="map-attachment"><h2>'+d+'</h2><span class="address">'+b.address2+", "+b.address3+"</span><hr>";e+='<div><div class="map-img-container"><img class="map-img" height="60" width="80" src="/assets/images/property/'+b.unique.toLowerCase()+"/"+b.featured+'" alt=""></div><div class="map-text-container"><h3>'+b.unique+'</h3></a><h4 class="score">'+(null!=b.stars?b.stars+" / 5":"")+'</h4></div></div><div class="clear"></div><hr>';var f=new google.maps.InfoWindow({content:e}),g=new google.maps.Marker({position:new google.maps.LatLng(b.gmapsdata.split(",")[0],b.gmapsdata.split(",")[1]),icon:"/assets/images/house-icon-free.png",title:d,map:a});g.addListener("click",function(){f.open(a,g)})},this.searchMap=function(d,e,f,g){var h,i,j,k={},l=[],m=!1,n=new google.maps.LatLng(12.919012,100.90433);d.setCenter(n),d.setZoom(12),a.each(e,function(a){k[a.id]||(k[a.name]='<style>hr{margin:10px 0;} .map-img-container h3 {margin-bottom:10px;}.address{font-size:10px}h2{font-size:16px;margin: 0;}h3,p{margin:0}h3{font-size:14px}h3,h4{color:#537cb4;margin-bottom:0}hr{border:none;border-bottom:1px solid #DADADA}.clear{clear:both}.booked,.free{float:left;clear:left;}.free{color:green}.booked{color:red}.map-attachment{width:210px;position:relative;padding-right:15px;overflow:hidden}.price,.score{float:left}.score{margin-top:0;margin-right:10px;font-size:12px;}.map-btn:focus{outline:0}.map-img-container{float:left;margin-right:15px;}.map-text-container{float:right;width:98px;}.map-text-container .price b{color:green;font-size:13px;}.price{clear:left;float:left;margin:0}</style><div class="map-attachment"><h2>'+a.name+'</h2><span class="address">'+a.address2+", "+a.address3+"</span><hr>"),k[a.name]+='<div><div class="map-img-container"><a href="/#/property/'+a.unique+'//" target="_blank"><img class="map-img" height="60" width="80" src="/assets/images/property/'+a.unique.toLowerCase()+"/"+a.featured+'" alt=""></a></div><div class="map-text-container"><a href="/#/property/'+a.unique+'//" target="_blank"><h3>'+a.unique+'</h3></a><h4 class="score">'+(null!=a.ratingavg?a.ratingavg+" / 5":"")+'</h4><p class="price"><b>'+c("currency")(g[a.id]?g[a.id].price:0,b.currency,0)+'</b></p><p class="free">Available</p><div class="clear"><a href="/#/property/'+a.unique+'//" target="_blank" target="_blank"><button class="map_book_button">Book</button></a></div></div></div><div class="clear"></div><hr>'}),a.each(f,function(a){k[a.id]||(k[a.name]='<style>hr{margin:10px 0;} .map-img-container h3 {margin-bottom:10px;}.address{font-size:10px}h2{font-size:16px;margin: 0;}h3,p{margin:0}h3{font-size:14px}h3,h4{color:#537cb4;margin-bottom:0}hr{border:none;border-bottom:1px solid #DADADA}.clear{clear:both}.booked,.free{float:left;clear:left;}.free{color:green}.booked{color:red}.map-attachment{width:210px;position:relative;padding-right:15px;overflow:hidden}.price,.score{float:left}.score{margin-top:0;margin-right:10px;font-size:12px;}.map-btn:focus{outline:0}.map-img-container{float:left;margin-right:15px;}.map-text-container{float:right;width:98px;}.map-text-container .price b{color:green;font-size:13px;}.price{clear:left;float:left;margin:0}</style><div class="map-attachment"><h2>'+a.name+'</h2><span class="address">'+a.address2+", "+a.address3+"</span><hr>"),k[a.name]+='<div><div class="map-img-container"><a href="/#/property/'+a.unique+'//" target="_blank"><img class="map-img" height="60" width="80" src="/assets/images/property/'+a.unique.toLowerCase()+"/"+a.featured+'" alt=""></a></div><div class="map-text-container"><h3><a href="/#/property/'+a.unique+'//" target="_blank">'+a.unique+'</a></h3><h4 class="score">'+(null!=a.ratingavg?a.ratingavg+" / 5":"")+'</h4><p class="price"><b>'+c("currency")(g[a.id]?g[a.id].price:0,b.currency,0)+'</b></p><p class="booked">Booked</p></div></div><div class="clear"></div><hr>'}),a.each(e,function(a){l[a.name]||(h=new google.maps.Marker({position:new google.maps.LatLng(parseFloat(a.gmapsdata.split(",")[0]),parseFloat(a.gmapsdata.split(",")[1])),icon:"/assets/images/house-icon-free.png",title:a.name,map:d}),l[a.name]=!0,j=new google.maps.InfoWindow({content:k[a.name]}),i=k[a.name],google.maps.event.addListener(h,"click",function(a,b,c){return function(){m&&m.close(),m=c,c.setContent(b),c.open(d,a)}}(h,i,j)))}),a.each(f,function(a){l[a.name]||(h=new google.maps.Marker({position:new google.maps.LatLng(parseFloat(a.gmapsdata.split(",")[0]),parseFloat(a.gmapsdata.split(",")[1])),icon:"/assets/images/house-icon-free.png",title:a.name,map:d}),l[a.name]=!0,j=new google.maps.InfoWindow({content:k[a.name]}),i=k[a.name],google.maps.event.addListener(h,"click",function(a,b,c){return function(){m&&m.close(),m=c,c.setContent(b),c.open(d,a)}}(h,i,j)))})}}])}(),function(){"use strict";angular.module("ThaiHome").directive("propertySnippet",["$templateCache",function(a){return{scope:!1,restrict:"AE",transclude:!0,template:function(){return a.get("templates/thaihome/google-search-snippet/property.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").directive("header",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/thaihome/header/index.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("home",{url:"/",title:"title_home",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/home/index.html")},controller:"HomeCtrl",resolve:{CurrentNews:["News","$q",function(a,b){var c=b.defer();return a.getNews().then(function(a){c.resolve(a)})["catch"](function(a){c.reject(a,404)}),c.promise}],CurrentHotDeals:["HotDeals","$q",function(a,b){var c=b.defer();return a.getDeals().then(function(a){c.resolve(a)})["catch"](function(a){c.reject(a,404)}),c.promise}],Locations:["$q","$http","CONFIG",function(a,b,c){var d=a.defer();return b.get(c.API_URL+"/location").then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}})}]).controller("HomeCtrl",["$state","CurrentNews","$rootScope","$interval","CurrentHotDeals","$http","Calendar","$scope","CONFIG","Locations","Locale","$sce",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=k.getDates();m.valid&&(h.checkin=m.checkin,h.checkout=m.checkout),h.news=b.data,h.deliberatelyTrustDangerousSnippet=function(a){return l.trustAsHtml(a)},c.$on("datesChanged",function(a,b){h.checkin=b.checkin,h.checkout=b.checkout}),g.loadCalendar(),h.HotDeals={properties:e.data.properties,prices:e.data.prices,hotdeals:e.data.hotdeals,translations:e.data.translations},h.locations=j.data,h.headerSlider=function(){f.get(i.API_URL+"/featured").success(function(a){var b=a;$(".home-bg img").attr("src","/assets/images/rotator/"+b[0].image);for(var e=0;e<b.length;e++)$("body").append('<img src="/assets/images/rotator/'+b[e].image+'" style="display:none"/>');if(1!=c.rotator){var f=1;c.rotator=!0;d(function(){$(".home-bg img").animate({opacity:.5},"500",function(){$(this).attr("src","/assets/images/rotator/"+b[f].image).animate({opacity:1},"100")}),f++,f==b.length&&(f=0)},i.HOME_IMAGE_TIMEOUT)}})},h.search=function(){return h.checkin&&h.checkout?void a.go("search",{location:h.location?h.location:0}):($(".arrival, .departure").data("dateRangePicker").open(),!1)}}])}(),function(){"use strict";angular.module("ThaiHome").factory("HotDeals",["$http","$q","CONFIG","Locale",function(a,b,c,d){return{getDeals:function(){var e=b.defer(),f=d.getDates(),g={};return f.valid&&(g={checkin:f.checkin,checkout:f.checkout,format:c.DEFAULT_DATE_FORMAT}),a.get(c.API_URL+"/hotdeals",{params:g}).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},getAll:function(d){var e=b.defer();return a.get(c.API_URL+"/hotdeal",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=b.defer();return a.post(c.API_URL+"/hotdeal",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=b.defer();return a.put(c.API_URL+"/hotdeal/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=b.defer();return a["delete"](c.API_URL+"/hotdeal/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=b.defer();return a.get(c.API_URL+"/hotdeal/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}]).directive("hotDeals",["$templateCache",function(a){return{template:function(){return a.get("templates/thaihome/hot-deals/index.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Invoice",["CONFIG","$http","$q","$templateCache","$rootScope",function(a,b,c,d,e){return{add:function(d){var e=c.defer();return b.post(a.API_URL+"/invoice/",d).then(function(a){e.resolve(a.data)}),e.promise},update:function(d){var e=c.defer();return b.update(a.API_URL+"/invoice/",d).then(function(a){e.resolve(a.data)}),e.promise},list:function(){var d=c.defer();return b.get(a.API_URL+"/invoice").then(function(a){d.resolve(a.data)}),d.promise},"delete":function(d){var e=c.defer();return b["delete"](a.API_URL+"/invoice/"+d).then(function(a){e.resolve(a.data)}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("IPLocation",["$http","$q","CONFIG",function(a,b,c){return{get:function(){var d=b.defer();return a.get(c.API_URL+"/getip").then(function(a){d.resolve(a)})["catch"](function(){d.reject()}),d.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Language",["$http","CONFIG","$q",function(a,b,c){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/language",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/language",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/language/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/language/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/language/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").controller("Locale",["$scope","CONFIG","$rootScope","$http",function(a,b,c,d){a.updateLanguage=function(a){localStorage.setItem("locale",a),d.get(b.API_URL+"/translations/"+a+".json").success(function(b){c.T=b,c.language=a})},a.updateCurrency=function(a){localStorage.setItem("currency",a),d.get(b.API_URL+"/findcol",{params:{collection:"currency",property:"currency",value:localStorage.getItem("currency")}}).success(function(d){a===b.DEFAULT_CURRENCY?c.currencyRate=1:c.currencyRate=c.currencyRates[a],c.currency=d.symbol,c.currencyname=d.name})}}]).service("Locale",["$http","$q","$rootScope","CONFIG",function(a,b,c,d){this.init=function(){a.get(d.API_URL+"/getip").success(function(b){function e(){a.get(d.API_URL+"/locale").success(function(b){c.languages=b.languages,c.currencies=b.currencies,a.get(d.API_URL+"/currencydata").success(function(a){var b=JSON.parse(a[0].data);c.currencyRates=b.rates,c.currencyRates[d.DEFAULT_CURRENCY]=1;var e=_.findWhere(c.currencies,{currency:localStorage.getItem("currency")});c.currencyname=e.name,c.currency=e.symbol,c.currencyRate=c.currencyRates[e.currency]})})}function f(){a.get("/translations/"+localStorage.getItem("locale")+".json").success(function(b){localStorage.getItem("locale")===d.DEFAULT_LANGUAGE?(c.TD=b,c.T=b):a.get("/translations/"+d.DEFAULT_LANGUAGE+".json").success(function(a){c.TD=a,c.T=a}),a.get(d.API_URL+"/findcol",{params:{collection:"language",property:"shortname",value:localStorage.getItem("locale")}}).success(function(a){c.language=a.shortname})})}null===localStorage.getItem("locale")&&localStorage.setItem("locale",d.DEFAULT_LANGUAGE),null===localStorage.getItem("currency")&&localStorage.setItem("currency",d.DEFAULT_CURRENCY),null===localStorage.getItem("locale")?null!=b.language?a.get(d.API_URL+"/findcol",{params:{collection:"language",property:"shortname",value:b.language}}).success(function(a){void 0!=a.shortname?localStorage.setItem("locale",a.shortname):localStorage.setItem("locale",d.DEFAULT_LANGUAGE),f()}):(localStorage.setItem("locale",d.DEFAULT_LANGUAGE),f()):f(),null===localStorage.getItem("currency")?null!=b.currency?a.get(d.API_URL+"/findcol",{params:{collection:"currency",property:"currency",value:b.currency}}).success(function(a){void 0!=a.currency?localStorage.setItem("currency",a.currency):localStorage.setItem("currency",d.DEFAULT_CURRENCY),e()}):(localStorage.setItem("currency",d.DEFAULT_CURRENCY),e()):e()})},this.period=function(a){var b,c;return a>6?(b=a/7,c=a-7*Math.floor(b),b=Math.floor(b)):(b=!1,c=a),b?b+" weeks, "+Math.ceil(c)+" nights":Math.ceil(c)+" nights"},this.setAgent=function(a){localStorage.setItem("agent",JSON.stringify({agent:a,expires:moment().add(7,"days").unix()}))},this.getAgent=function(){var a=localStorage.getItem("agent");return a=JSON.parse(a),_.isObject(a)?moment().unix()>a.expires?!1:a.agent:!1},this.setDates=function(a,b){localStorage.setItem("checkin",a),localStorage.setItem("checkout",b),localStorage.setItem("dateexpire",moment().add(1,"hour").unix())},this.setDefaultDates=function(a){var b=moment().format(d.DEFAULT_DATE_FORMAT),c=1;a&&(c=7);var e=moment().add(c,"day").format(d.DEFAULT_DATE_FORMAT);return this.setDates(b,e),{checkin:b,checkout:e}},this.getDates=function(a,b){var c=localStorage.getItem("checkin"),d=localStorage.getItem("checkout"),e=localStorage.getItem("dateexpire"),f=!0;if(e&&parseInt(moment().unix())-parseInt(e)>0&&(f=!1),this.validateDates(c,d)===!1&&(f=!1,a===!0)){var g=this.setDefaultDates(b);c=g.checkin,d=g.checkout,f=!0}return{checkin:c,checkout:d,valid:f}},this.deleteDates=function(){localStorage.removeItem("checkin"),localStorage.removeItem("checkout")},this.validateDates=function(a,b){var c=!0,e=moment(new Date,d.DEFAULT_DATE_FORMAT);return moment(a,d.DEFAULT_DATE_FORMAT,!0).isValid()&&moment(b,d.DEFAULT_DATE_FORMAT,!0).isValid()||(c=!1),(moment(a,d.DEFAULT_DATE_FORMAT).diff(e,"days")<0||moment(b,d.DEFAULT_DATE_FORMAT).diff(e,"days")<1)&&(c=!1),c}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Location",["$http","CONFIG","$q",function(a,b,c){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/location",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/location",d).then(function(a){e.resolve(a);
})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/location/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/location/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/location/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").service("Modal",["$uibModal","$rootScope","$templateCache","CONFIG","Property","DTOptionsBuilder","User","Discount","Location","Email","Notification","Currency","$filter","Season","$sce",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){this.openGallery=function(d,e){var f=c.get("templates/thaihome/property-gallery/index.html"),g=b.$new();g.images=d,g.unique=e,a.open({windowClass:"property-gallery",template:f,scope:g,controller:"GalleryCtrl",animation:!0})},this.propertyDetails=function(d,e,f){var g=c.get("templates/thaihome/property-details/more.html"),h=b.$new();h.showMoreClose=f,h.property=d,h.translation=e,a.open({windowClass:"about-property",template:g,scope:h,animation:!0})},this["default"]=function(b){var d=c.get("templates/thaihome/modal/template.html");a.open({template:'<i class="material-icons" id="close-window"  ng-click="$close()">highlight_off</i><p>'+b+"</p>",windowTemplate:d,scope:!1,animation:!0})},this.rules=function(b){var d=c.get("templates/thaihome/modal/template.html");a.open({template:'<i class="material-icons" id="close-window"  ng-click="$close()">highlight_off</i><h3>House Rules</h3><p class="wrapspace">'+b.texts[0].house_rules+"</p>",windowTemplate:d,scope:!1,windowClass:"property-rules",animation:!0})},this.messageReceived=function(){return!1},this.tags=function(b){var d=c.get("templates/thaihome/modal/template.html"),e=c.get("templates/lists/tags/index.html");a.open({template:e,windowTemplate:d,animation:!0})},this.cancellation=function(){var b=c.get("templates/thaihome/modal/template.html");a.open({template:'<i class="material-icons" id="close-window"  ng-click="$close()">highlight_off</i><h3>Cancellation Policy</h3><p>1) Cleaning fees are always refunded if the guest did not check in.<br /><br />2) Cancellation must be by email to note@flipinvert.com<br /><br />3) For a full refund, cancellation must be made 5 days before the check in, if later than 5 days, any booking fee or deposit will be kept by the </p>',windowTemplate:b,scope:!1,windowClass:"property-rules",animation:!0})},this.bookingList=function(d){var e=b.$new(!0);e.bookings=d,e.dtOptions=f.newOptions();var g=c.get("templates/thaihome/modal/template.html"),h=c.get("templates/lists/booking/index.html");a.open({template:h,windowTemplate:g,scope:e,animation:!0})},this.newBooking=function(b,d){var e=c.get("templates/thaihome/modal/template-noclose.html");a.open({backdrop:"static",template:"<h3>Your booking has been saved</h3><p>A booking confirmation will be sent to "+b+' as  soon as we receive the payment. <br />Please note, a bank transfer can take 4-6 days, we will notify you as soon as we get the money</p><p><a ng-click="$close()" href="javascript:void(0);" ui-sref="booking({id: \''+d+'\' })"><md-button class="md-raised md-primary">View Booking Status</md-button></a> <md-button class="md-raised md-primary" ng-click="$close()">Continue with Payment</md-button></p>',windowTemplate:e,scope:!1,animation:!1})},this.newBookingManagement=function(b){var d=c.get("templates/thaihome/modal/template-noclose.html");a.open({backdrop:"static",template:'<h3>Booking has been saved</h3><p><a ng-click="$close()" href="javascript:void(0);" ui-sref="management.home()" ui-sref-opts="{reload:true}"><md-button class="md-raised md-primary">View Booking Status</md-button></a></p>',windowTemplate:d,scope:!1,animation:!1})},this.minimDays=function(b){var d=c.get("templates/thaihome/modal/template-noclose.html");a.open({backdrop:"static",template:"<h3>Sorry</h3><p>This property requires a minimum booking period of <b>"+b+'</b> nights</p><p><a ng-click="$close()" href="javascript:void(0);"><md-button class="md-raised md-primary">OK</md-button></a></p>',windowTemplate:d,scope:!1,animation:!1})},this.doubleBooking=function(b){var e=c.get("templates/thaihome/modal/template-noclose.html");$(".page-loading").addClass("hide"),a.open({backdrop:"static",template:"<h3>Dates not available</h3><p>We're sorry but it appears these dates (<b>"+moment.unix(b.checkin).utc().format(d.DEFAULT_DATE_FORMAT)+" - "+moment.unix(b.checkout).utc().format(d.DEFAULT_DATE_FORMAT)+'</b>) are allready booked</p><p>Please go back and select other dates<p><a ng-click="openCalendar();$close();" href="javascript:void(0);"><md-button class="md-raised md-primary">Back</md-button></a></p>',windowTemplate:e,scope:!1,animation:!1})},this.doubleBookingAgent=function(b){var e=c.get("templates/thaihome/modal/template-noclose.html");$(".page-loading").addClass("hide"),a.open({backdrop:"static",template:"<h3>Dates not available</h3><p>We're sorry but it appears these dates (<b>"+moment.unix(b.checkin).format(d.DEFAULT_DATE_FORMAT)+" - "+moment.unix(b.checkout).format(d.DEFAULT_DATE_FORMAT)+'</b>) are allready booked</p><p>Please go back and select other dates<p><a ui-sref="agent.home" ng-click="$close();" href="javascript:void(0);"><md-button class="md-raised md-primary">Back</md-button></a></p>',windowTemplate:e,scope:!1,animation:!1})},this.newBookingAgent=function(b,d){var e=c.get("templates/thaihome/modal/template-noclose.html");a.open({backdrop:"static",template:"<h3>Your booking has been saved</h3><p>A booking confirmation will be sent to "+b+' as  soon as we receive the payment. <br />Please note, a bank transfer can take 4-6 days, we will notify you as soon as we get the money</p><p><a ng-click="$close()" href="javascript:void(0);" ui-sref="agent.booking({id: \''+d+'\' })"><md-button class="md-raised md-primary">View Booking Status</md-button></a></p>',windowTemplate:e,scope:!1,animation:!1})},this.newAgent=function(){var b=c.get("templates/thaihome/modal/template-noclose.html");a.open({backdrop:"static",template:'<h3>Successfully Registered</h3><br><p><a ng-click="$close()" href="javascript:void(0);" ui-sref="agent_login"><md-button class="md-raised md-primary">Login</md-button></a></p>',windowTemplate:b,scope:!1,animation:!1})},this.ownership=function(){var b=c.get("templates/thaihome/modal/template.html");a.open({template:'<i class="material-icons" id="close-window"  ng-click="$close()">highlight_off</i><p><b>Tenant Ownership</b><p>If you are the agent who first booked this tenant, then you are the tenant owner. This means that any future bookings this tenant makes with us will pay commission to you for the next 2 years. Even if the tenant books directly with us or extends his lease with us, you will still be paid <b><u>full commission!</u></b></p><br /><p><b>Send booking to Tenant</b></p><p>You can send the booking link to the tenant. This will show information and photos to the tenant with your agency name on the booking form. It will also allow the tenant to pay the booking via credit cards, paypal or bank transfer directly into our account via our online secure payment system. We will inform you once the tenant has paid and transfer your commission. </p>',windowTemplate:b,scope:!1,animation:!1})},this.rating=function(){var b=c.get("templates/thaihome/modal/template.html");a.open({template:'<p>Your rating has been saved</p><p>Thank you!</p><p><a ui-sref="home" ui-sref-opts="{reload:true}" ng-click="$close()" style="cursor:pointer;"><button class="btn btn-primary">Back to Thaihome</button></a></p>',windowTemplate:b,scope:!1,animation:!0})},this.throwError=function(b){var d=c.get("templates/thaihome/modal/template.html");a.open({template:"<h3>ERROR:</h3><br /><p>"+b+"</p>",windowTemplate:d,scope:!1,animation:!0})},this.agentList=function(d,e){var h=this;g.getAll({type:"agent"}).then(function(g){var i=b.$new(!0);i.agents=g,i.commission=e,i.conditionsAgent="",i.dtOptions=f.newOptions(),i.selectAgent=function(a,c,d){b.$broadcast("agentSelected",a,c,d)},i.showExtra=d?!0:!1,i.addAgent=function(){h.addAgent()};var j=c.get("templates/thaihome/modal/template.html"),k=c.get("templates/lists/agent/index.html");a.open({template:k,windowTemplate:j,scope:i,animation:!0})})},this.addTenant=function(){var d=c.get("templates/thaihome/modal/template.html"),e=c.get("templates/lists/tenant/add.html"),f=b.$new(!0);f.createTenant=function(a){h.close(),a.type="tenant",a.password=a.email,a.username=a.email,g.add(a).then(function(a){b.$broadcast("tenantSelected",a.data)})};var h=a.open({template:e,windowTemplate:d,scope:f,animation:!0})},this.addAgent=function(){var d=c.get("templates/thaihome/modal/template.html"),e=c.get("templates/lists/agent/add.html"),f=b.$new(!0);f.createAgent=function(a){h.close(),a.type="agent",a.agent=a.name,g.add(a).then(function(a){b.$broadcast("agentSelected",a.data)})};var h=a.open({template:e,windowTemplate:d,scope:f,animation:!0})},this.tenantList=function(){var d=this;g.getAll({type:"tenant"}).then(function(e){var g=b.$new(!0);g.tenants=e,g.addTenant=function(){d.addTenant()},g.dtOptions=f.newOptions(),g.selectTenant=function(a){b.$broadcast("tenantSelected",a)};var h=c.get("templates/thaihome/modal/template.html"),i=c.get("templates/lists/tenant/index.html");a.open({template:i,windowTemplate:h,scope:g,animation:!0})})},this.seasonList=function(){var d=b.$new(!0);d.seasons=n.list(),d.dtOptions=f.newOptions(),d.selectSeason=function(a){b.$broadcast("seasonSelected",a)};var e=c.get("templates/thaihome/modal/template.html"),g=c.get("templates/lists/season/index.html");a.open({template:g,windowTemplate:e,scope:d,animation:!0})},this.currencyList=function(){l.getAll().then(function(d){var e=b.$new(!0);e.currencies=d,e.dtOptions=f.newOptions();var g=c.get("templates/thaihome/modal/template.html"),h=c.get("templates/lists/currency/index.html");a.open({template:h,windowTemplate:g,scope:e,animation:!0,controller:"Locale"})})},this.statusList=function(d){var e=b.$new(!0);e.statuses=d,e.dtOptions=f.newOptions(),e.selectStatus=function(a){b.$broadcast("statusSelected",a)};var g=c.get("templates/thaihome/modal/template.html"),h=c.get("templates/lists/status/index.html");a.open({template:h,windowTemplate:g,scope:e,animation:!0,controller:"Locale"})},this.locationList=function(){i.getAll().then(function(d){var e=b.$new(!0);e.locations=d,e.dtOptions=f.newOptions(),e.selectLocation=function(a){b.$broadcast("locationSelected",a)};var g=c.get("templates/thaihome/modal/template.html"),h=c.get("templates/lists/location/index.html");a.open({template:h,windowTemplate:g,scope:e,animation:!0})})},this.propertyList=function(d,g){k.success({message:"Loading..."}),e.getAllDetails(d,g).then(function(d){var e=d,g=b.$new(!0);g.data=e,g.dtOptions=f.newOptions().withOption("bPaginate",!1),g.selectProperty=function(a){b.$broadcast("propertySelected",a)},g.currency=b.currency;var h=c.get("templates/thaihome/modal/template.html"),i=c.get("templates/lists/property/index.html");a.open({template:i,windowTemplate:h,scope:g,animation:!0})})},this.discountList=function(){h.findAll({active:!0}).then(function(d){var e=c.get("templates/thaihome/modal/template.html"),g=c.get("templates/lists/discount/index.html"),h=d,i=b.$new(!0);i.data=h,i.dtOptions=f.newOptions(),i.selectDiscount=function(a){b.$broadcast("discountSelected",a)},a.open({template:g,windowTemplate:e,scope:i,animation:!0})})}}])}(),function(){"use strict";angular.module("ThaiHome").directive("navigation",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/thaihome/navigation/index.html")}}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("news",{url:"/news/",title:"title_news",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/news/index.html")},controller:"NewsCtrl",resolve:{News:["$q","News",function(a,b){var c=a.defer();return b.getAll().then(function(a){c.resolve(a)}),c.promise}]}})}]).controller("NewsCtrl",["$scope","News","$sce",function(a,b,c){a.news=b,a.nrNews=5,a.moreNews=function(){a.nrNews+=a.nrNews},a.deliberatelyTrustDangerousSnippet=function(a){return c.trustAsHtml(a)}}]).factory("News",["$http","CONFIG","$q","dpd",function(a,b,c,d){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/news",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},getNews:function(){var d=c.defer(),e=moment().format("X"),f={start:{$lte:e},end:{$gte:e}};return a.get(b.API_URL+"/news",{params:f}).then(function(a){d.resolve(a.data)})["catch"](function(a){d.resolve({data:[]})}),d.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/news",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/news/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/news/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/news/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").controller("Newsletter",["CONFIG","Modal","$scope","$http",function(a,b,c,d){c.add=function(){d.post(a.API_URL+"/newsletter",{email:c.email,added:moment().unix()}).success(function(a){"duplicate"===a.message?(b["default"]("Your email already exists in our newsletter list."),c.email=""):(b["default"]("Your email has been added to our newsletter list."),c.email="")})}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Payment",[function(){return{methods:function(){return[{id:0,name:"Bank Transfer",directive:"bank",cc:!1},{id:1,name:"CreditCard",directive:"siampay",cc:!0},{id:2,name:"Paid to Agent",directive:"paid_to_agent",cc:!1},{id:3,name:"PayPal",directive:"paypal",cc:!1},{id:4,name:"Cash",directive:"cash",cc:!1}]}}}]).directive("paymentBank",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/payment/bank/index.html")}}}]).directive("paymentStepOne",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/payment/steps/first.html")}}}]).directive("paymentStepTwo",["$templateCache",function(a){return{restrict:"AE",template:function(){return a.get("templates/payment/steps/final.html")}}}]).filter("numberFixedLen",function(){return function(a,b){var c=parseInt(a,10);if(b=parseInt(b,10),isNaN(c)||isNaN(b))return a;for(c=""+c;c.length<b;)c="0"+c;return c}}).controller("SiamPayCtrl",["$scope","$state","$sce",function(a,b,c){a.DATA={URL:c.trustAsResourceUrl("https://test.siampay.com/b2cDemo/eng/payment/payForm.jsp"),MERCHANT_ID:{USD:76062645,EUR:76062672,THB:76062633},PAYMENT_TYPE:"N",PAYMENT_METHOD:"ALL",MPS_MODE:"NIL"},a.currencyCodes=[{name:"USD",code:"840"},{name:"EUR",code:"978"},{name:"THB",code:"764"}],a.languageCodes=[{name:"en",code:"E"},{name:"th",code:"T"}];var d=(new Date).getFullYear(),e=[];e.push(d);for(var f=1;20>f;f++)e.push(d+f);a.years=e}]).directive("paymentSiampay",["$templateCache","$state","CONFIG",function(a,b,c){return{controller:"SiamPayCtrl",restrict:"AE",link:function(a,d,e){a.amount=e.amount,a.bookingid=e.bookingid;var f=_.findWhere(a.currencyCodes,{name:e.currency});f?a.amount=a.amount*parseFloat(e.rate):f=_.findWhere(a.currencyCodes,{name:c.DEFAULT_CURRENCY}),a.currencycode=f.code;var g=_.findWhere(a.languageCodes,{name:e.language});g||(g=_.findWhere(a.languageCodes,{name:"en"})),a.languagecode=g.code;var h=b.href("payment.success",{id:e.bookingid},{absolute:!0});a.ccSuccessURL=h;var i=b.href("payment.fail",{id:e.bookingid},{absolute:!0});a.ccFailURL=i,a.amount=parseInt(a.amount),a.merchantid=a.DATA.MERCHANT_ID[e.currency],a.merchantid||(a.merchantid=a.DATA.MERCHANT_ID.THB)},template:function(){return a.get("templates/payment/siampay/index.html")}}}]).config(["$stateProvider",function(a){a.state("payment",{url:"/payment/",template:"<ui-view></ui-view>"}).state("payment.success",{url:"success/:id/",css:"/css/style.css",templateProvider:function(a){return a.get("templates/payment/siampay/success.html")},controller:["$state","$stateParams","$scope",function(a,b,c){localStorage.removeItem("past-booking-id"),c.bookingURL=a.href("booking",{id:b.id},{absolute:!0})}],resolve:{doPayment:["$stateParams","$state","Booking","$q","$rootScope","Email","Locale",function(a,b,c,d,e,f,g){var h=d.defer();return c.getDetails(a.id).then(function(a){var b=0;_.map(a.data.priceExtra,function(a){b.priceExtra+=parseInt(a.price)});var d=0;d=a.data.priceReservation?a.data.priceReservation:a.data.cleanfinalprice+(a.data.priceDay*a.data.nights-a.data.priceDay*a.data.nights/100*a.data.discountPercentage)+b;var g=moment().utc().unix(),i={updated:g,paymentDate:g,pricePaid:d,status:3,paymentType:1};c.update(a.data.id,i).then(function(a){h.resolve(a)}),e.$watch("T",function(){e.T&&f.send("payment_pending",{booking:a.data.id,preview:!1,subject:e.T&&e.T.email_subject_payment_pending?e.T.email_subject_payment_pending:"Payment Pending",language:e.language})})})["catch"](function(){h.reject()}),h.promise}]}}).state("payment.fail",{url:"fail/:id/?errorMsg",css:"/css/style.css",controller:["$scope","$stateParams","$state",function(a,b,c){a.error=b.errorMsg,a.bookingURL=c.href("booking",{id:b.id},{absolute:!0})}],templateProvider:function(a){return a.get("templates/payment/siampay/fail.html")},resolve:{}})}])}(),function(){"use strict";angular.module("ThaiHome").factory("Period",["$http","CONFIG","$q",function(a,b,c){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/season",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/season",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/season/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/season/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/season/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Price",["$http","CONFIG","$q",function(a,b,c){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/price",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/price",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/price/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/price/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/price/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").controller("GalleryCtrl",["$scope",function(a){a.width=59,a.modalHeight=555+110*parseInt(a.images.length/12),a._Index=0,a.$watch("_Index",function(){$("#photogallery .nav").css("left","-"+a._Index*a.width+"px")}),a.isActive=function(b){return a._Index===b},a.showPrev=function(){a._Index=a._Index>0?--a._Index:a.images.length-1},a.showNext=function(){a._Index=a._Index<a.images.length-1?++a._Index:0},a.showPhoto=function(b){a._Index=b},a.initSpace=function(){$(document).bind("keydown","space",function(a){return $(this).find(".nextimg").click(),a.preventDefault(),!1})}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("property",{url:"/property/:id/:discount/:agent/:action/",params:{id:{value:null,squash:!0},agent:{value:null,squash:!0},discount:{value:null,squash:!0},action:{value:null,squash:!0}},title:"title_property",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/property/index.html")},controller:"PropertyCtrl",resolve:{currentUser:["Auth","$q",function(a,b){var c=b.defer();return a.checkLogged().then(function(a){c.resolve(a)})["catch"](function(){c.resolve({})}),c.promise}],Agent:["$q","$stateParams","User","Locale",function(a,b,c,d){var e=a.defer();return b.agent?c.getDetails(b.agent).then(function(a){"agent"===a.type?(e.resolve(a),d.setAgent(a.id)):e.resolve(!1)})["catch"](function(){e.resolve(!1)}):d.getAgent()?c.getDetails(d.getAgent()).then(function(a){"agent"===a.type?e.resolve(a):e.resolve(!1)})["catch"](function(){e.resolve(!1)}):e.resolve(!1),e.promise}],PropertyData:["Property","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}],Ratings:["Rating","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getPropertyRatings(c.id).then(function(a){d.resolve(a)}),d.promise}],Message:["Contact","$q","Auth",function(a,b,c){var d=b.defer();return c.checkLogged().then(function(b){return a.getMessage(null,b.data.id,null)}).then(function(a){d.resolve(a)}),d.promise}]}})}]).factory("Property",["$http","$q","CONFIG","Search",function(a,b,c,d){return{getDetails:function(d){var e=b.defer();return d?a.post(c.API_URL+"/property-details/",{id:d,language:localStorage.getItem("locale")}).then(function(a){e.resolve(a)},function(a){e.reject(a)}):e.reject(),e.promise},"delete":function(d){var e=b.defer();return a["delete"](c.API_URL+"/property/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=b.defer();return a.post(c.API_URL+"/property",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getAll:function(){var d=b.defer();return a.get(c.API_URL+"/property").then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},getAllDetails:function(a,e){a&&e||(a=moment().format(c.DEFAULT_DATE_FORMAT),e=moment().add(7,"days").format(c.DEFAULT_DATE_FORMAT));var f=b.defer();return d.getResults(0,a,e).then(function(a){f.resolve(a.data)}),f.promise}}}]).directive("propertyDetails",["$templateCache",function(a){return{restrict:"AE",scope:!1,template:function(){return a.get("templates/thaihome/property-details/index.html")}}}]).directive("propertyAbout",["$templateCache",function(a){return{restrict:"AE",scope:!1,template:function(){return a.get("templates/thaihome/property-details/about.html")}}}]).directive("propertyMoreinfo",["$templateCache",function(a){return{restrict:"AE",scope:!1,template:function(){return a.get("templates/thaihome/property-details/more.html")}}}]).controller("PropertyCtrl",["Modal","currentUser","Message","$http","$scope","PropertyData","Ratings","Calendar","Contact","$rootScope","CONFIG","gMaps","$state","$stateParams","Discount","Agent","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){e.chatdisabled=!1,e.propertyDetails=!1,e.showPrices=!1,h.loadCalendar(!1,!1,!1,f.data.bookings),e.property=f.data.property,e.translation=f.data.translation,e.price=f.data.price,e.discount={},e.discount.percentage=0,e.refAgent=p,j.agent&&(e.rentlink=m.href("property",{id:e.property.unique,agent:j.agent.id},{absolute:!0}),e.salelink=m.href("sale",{id:e.property.unique,agent:j.agent.id},{absolute:!0})),b.data?(e.contact={},e.contact.name=b.data.name,e.contact.email=b.data.email,e.contact.message=""):e.contact={},_.isEmpty(c)?e.messages={}:(e.messages=c,q(function(){$(".smaller-chat").scrollTop($(".smaller-chat")[0].scrollHeight)},1e3)),e.discount={percent:0},e.applyDiscount=function(){return e.discount_code?void o.getDiscount(e.discount_code,b.data.id,e.property.id).then(function(a){a.length?e.discount=a[0]:(e.discount={percent:0},e.discount_code="Invalid")}):(e.invalidDiscount="Invalid",!1)},n.discount&&(e.discount_code=n.discount,e.applyDiscount()),e.book=function(){return e.checkin&&e.checkout?e.property.minimDays>e.nights?(a.minimDays(e.property.minimDays),!1):void m.go("book",{id:n.id,agent:e.refAgent?e.refAgent.id:"",discount:e.discount.code}):($(".arrival, .departure").data("dateRangePicker").open(),!1)},e.askQuestion=function(){e.chatdisabled=!0,i.askQuestion(e.contact,!1,e.property.id).then(function(b){e.messages=b,a.messageReceived(),e.contact.message="",e.chatdisabled=!1})},e.getDay=function(a){return i.getDay(a)},e.getSubArray=function(a,b,c){return a.slice(b,c)},e.ratings=g.data;var r=0;_.each(e.ratings,function(a,b){r+=a.avgRating,e.ratings.length===b+1&&(e.stars=r/e.ratings.length)}),e.$on("mapInitialized",function(a,b){var c={address2:e.property.address2,address3:e.property.address3,name:e.property.name,featured:e.property.featured,unique:e.property.unique,gmapsdata:e.property.gmapsdata};l.propertyMap(b,c)}),e.openGallery=function(){a.openGallery(e.property.images,e.property.unique)},e.rules=function(){a.rules(e.translation)},e.cancellation=function(){a.cancellation()},e.openCalendar=function(){$(".arrival, .departure").data("dateRangePicker").open()},j.$on("datesChanged",function(a,b){e.checkin=b.checkin,e.checkout=b.checkout,d.get(k.API_URL+"/getprice",{params:{property:e.property.id,checkin:b.checkin,checkout:b.checkout,format:k.DEFAULT_DATE_FORMAT}}).success(function(a){e.priceDay=a.price,e.nights=a.nights}),e.showPrices=!0}),"chat"===n.action&&$("html,body").animate({scrollTop:$("chat").offset().top-100}),e.scrollToChat=function(){$("html,body").animate({scrollTop:$("chat").offset().top-100})},"contact"===n.action&&($("html,body").animate({scrollTop:$("chat").offset().top-400}),$("#txtChat").focus())}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("rate",{url:"/rating/:id/",title:"title_rate",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/rating/rate.html")},controller:"RatingCtrl",resolve:{Data:["Booking","Rating","$q","$stateParams",function(a,b,c,d){var e=c.defer(),f={};return a.getDetails(d.id).then(function(a){return f.booking=a.data,b.getBookingRating(d.id)}).then(function(a){f.rating=a,e.resolve(f)})["catch"](function(a){e.reject(a,404)}),e.promise}]}})}]).factory("Rating",["$http","$q","CONFIG",function(a,b,c){return{save:function(d){d.avgRating=Math.round((parseInt(d.ratings[0])+parseInt(d.ratings[1])+parseInt(d.ratings[2]))/3*2)/2;var e=b.defer();return a.post(c.API_URL+"/rating",d).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},getBookingRating:function(d){var e=b.defer();return a.get(c.API_URL+"/rating",{params:{booking:d}}).then(function(a){a.data.length?e.resolve(a.data[0]):e.resolve({})},function(){e.resolve()}),e.promise},getRatings:function(){var d=b.defer();return a.get(c.API_URL+"/rating",{params:{active:!0}}).then(function(a){d.resolve(a)},function(){d.resolve()}),d.promise},getPropertyRatings:function(d){var e=b.defer();return a.get(c.API_URL+"/rating",{params:{active:!0,property:d}}).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},getAll:function(d){var e=b.defer();return a.get(c.API_URL+"/rating",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=b.defer();return a.post(c.API_URL+"/rating",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=b.defer();return a.put(c.API_URL+"/rating/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=b.defer();return a["delete"](c.API_URL+"/rating/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=b.defer();return a.get(c.API_URL+"/rating/",{params:{details:!0,id:d}}).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}]).controller("RatingCtrl",["Data","Discount","Modal","Rating","$scope",function(a,b,c,d,e){e.data=a.booking,a.rating.id?(e.rating=a.rating,e.ty=!0,b.find({booking:a.booking.id}).then(function(a){e.discount=a})):e.rating={property:e.data.property.id,booking:e.data.id,ratings:[3,3,3],active:!1,user:e.data.user.id,date:moment().unix(),avgRating:3},e.save=function(){d.save(e.rating).then(function(){c.rating(),b.generate(e.data.user.email,e.data.id).then(function(a){e.rating=a}),e.ty=!0})["catch"](function(a){c.throwError(JSON.stringify(a.data.errors))})}}]).directive("ratings",["$templateCache",function(a){return{template:function(){return a.get("templates/thaihome/ratings/index.html")}}}]).directive("stars",["$templateCache",function(a){return{restrict:"E",template:function(){return a.get("templates/thaihome/ratings/stars.html")},scope:{stars:"@stars"},link:function(a){a.times=function(a){return a>0?new Array(a):void 0},a.Math=Math,a.fullstars=function(){return Math.floor(a.stars)},a.halfstars=function(){var b=parseFloat(a.stars)-parseFloat(a.fullstars());return b>0?1:0},a.emptystars=function(){return parseInt(5-parseInt(a.fullstars())-parseInt(a.halfstars()))}}}}]).directive("starRating",function(){return{restrict:"A",template:'<ul class="rating" ng-class="{readonly: rating.id}">	<li ng-repeat="star in stars" ng-class="star" ng-click="toggle($index)">★</li></ul>',scope:{ratingValue:"=",max:"=",onRatingSelected:"&"},link:function(a){var b=function(){a.stars=[];for(var b=0;b<a.max;b++)a.stars.push({filled:b<a.ratingValue})};a.toggle=function(b){a.ratingValue=b+1,a.onRatingSelected({rating:b+1})},a.$watch("ratingValue",function(a,c){c&&b()})}}})}(),function(){"use strict";angular.module("ThaiHome").factory("Receipt",["CONFIG","$http","$q","$templateCache","$rootScope",function(a,b,c,d,e){return{add:function(d){var e=c.defer();return b.post(a.API_URL+"/receipt/",d).then(function(a){e.resolve(a.data)}),e.promise},getAll:function(){var d=c.defer();return b.get(a.API_URL+"/receipt/").then(function(a){d.resolve(a.data)}),d.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("sale",{url:"/sale/:id/:agent/",title:"title_property",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/sale/index.html")},controller:"PropertyCtrl",resolve:{currentUser:["Auth","$q",function(a,b){var c=b.defer();return a.checkLogged().then(function(a){c.resolve(a)})["catch"](function(a){c.resolve({})}),c.promise}],Agent:["$q","$stateParams","User","Locale",function(a,b,c,d){var e=a.defer();return b.agent?c.getDetails(b.agent).then(function(a){"agent"===a.type?(e.resolve(a),d.setAgent(a.id)):e.resolve(!1)})["catch"](function(){e.resolve(!1)}):d.getAgent()?c.getDetails(d.getAgent()).then(function(a){"agent"===a.data.type?e.resolve(a.data):e.resolve(!1)})["catch"](function(){e.resolve(!1)}):e.resolve(!1),e.promise}],PropertyData:["Property","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}],Ratings:["Rating","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getPropertyRatings(c.id).then(function(a){d.resolve(a)}),d.promise}],Message:["Contact","$q","Auth",function(a,b,c){var d=b.defer();return c.checkLogged().then(function(b){
a.getMessage(null,b.data.id,null).then(function(a){d.resolve(a)})["catch"](function(a){d.resolve({data:[]})})}),d.promise}]}})}])}(),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("search",{url:"/search/:location/",title:"title_search",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/search/index.html")},params:{sortBy:"-price"},controller:"SearchCtrl",resolve:{Results:["Search","$q","$stateParams","Locale",function(a,b,c,d){var e=d.getDates(),f=b.defer();if(e.valid)var g=e.checkin,h=e.checkout;else f.reject("Dates not set",401);return a.getResults(c.location,g,h).then(function(a){f.resolve(a)})["catch"](function(a){f.reject(a,404)}),f.promise}],Locations:["$q","$http","CONFIG",function(a,b,c){var d=a.defer();return b.get(c.API_URL+"/location").then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}})}]).factory("Search",["$http","$q","CONFIG",function(a,b,c){return{getResults:function(d,e,f){var g=b.defer();return e&&f?a.get(c.API_URL+"/search-booking/",{params:{location:d,checkin:e,checkout:f,language:localStorage.getItem("locale"),format:c.DEFAULT_DATE_FORMAT}}).then(function(a){g.resolve(a)},function(a){g.reject(a)}):g.reject(),g.promise}}}]).controller("SearchCtrl",["Modal","$http","$scope","Results","Locations","Calendar","$rootScope","CONFIG","gMaps","$stateParams","$state","Locale","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m){f.loadCalendar(),c.locations=e.data,c.limits={free:10,booked:0,increment:10},c.sortBy=j.sortBy||"-price",c.search=function(){k.go("search",{location:c.location?c.location:0,sortBy:c.sortBy},{reload:!0})},c.translations=d.data.translations,c.location=j.location,c.freeProperties=d.data.free,c.artificial=d.data.artificial,c.bookedProperties=d.data.booked;var n=l.getDates();c.days=parseInt(moment(n.checkout,h.DEFAULT_DATE_FORMAT).diff(n.checkin,"days"));var o=c.freeProperties.length+c.bookedProperties.length;c.availableCount=o,c.prices=d.data.prices,0!=c.location?c.locationName=_.findWhere(c.locations,{id:c.location}).name:c.locationName="All Locations",c.$on("mapInitialized",function(a,b){i.searchMap(b,c.freeProperties,c.bookedProperties,c.prices)}),c.increaseLimit=function(){c.removeWatch(),c.limits.free=c.limits.free+c.limits.increment,c.freeProperties.length<=c.limits.free&&(c.limits.booked+=c.limits.increment),c.watchPhoto()},c.freeProperties.length<c.limits.free&&(c.limits.booked+=c.limits.increment),c.removeWatch=function(){jQuery(".offer").off("mouseenter"),jQuery(".offer").off("mouseleave"),jQuery(".img_switch_left, .img_switch_right").off("click")},c.watchPhoto=function(){m(function(){jQuery(document).ready(function(){jQuery(".offer").mouseenter(function(){jQuery(this).find(".img_switch_left, .img_switch_right").show()}),jQuery(".offer").mouseleave(function(){jQuery(".img_switch_left, .img_switch_right").hide()}),jQuery(".img_switch_left, .img_switch_right").click(function(a){var b=jQuery(this).parent(".prop_img_cont").find("img.offerimg"),d=jQuery(b).attr("property"),e=parseInt(jQuery(this).attr("direction"));c.switchPhoto(d,b,e)})})})},c.switchPhoto=function(a,b,d){var e=_.findWhere(c.freeProperties,{unique:a.toUpperCase()});e||(e=_.findWhere(c.bookedProperties,{unique:a.toUpperCase()}));var f=e.images,g=jQuery(b).attr("src");g=g.split("/"),g=g[g.length-1];var h=parseInt(f.indexOf(g)),i=f[0];i=d&&f[h+1]?f[h+1]:d&&!f[h+1]?f[0]:!d&&f[h-1]?f[h-1]:f[f.length-1];var j=jQuery(b).attr("src").replace(g,i);jQuery(b).attr("src",j)},c.swipe=function(a,b){var d=jQuery(b.target),e=jQuery(d).attr("property");c.switchPhoto(e,d,a)},c.watchPhoto()}])}(),function(){"use strict";angular.module("ThaiHome").factory("Season",["$http","CONFIG","$q",function(a,b,c){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/season",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/season",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/season/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/season/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/season/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise},list:function(){return["BASE","LOW","MEDIUM","HIGH","SUPER"]}}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Token",[function(){function a(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;20>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}return{genToken:a}}])}(),function(){"use strict";angular.module("ThaiHome").factory("Translation",["$http","CONFIG","$q","dpd",function(a,b,c,d){return{getAll:function(a){var b=c.defer();return d.translation.get(a).then(function(a){b.resolve(a.data)})["catch"](function(a){b.reject(a)}),b.promise},add:function(d){var e=c.defer();return a.post(b.API_URL+"/translation",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/translation/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/translation/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d){var e=c.defer();return a.get(b.API_URL+"/translation/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?e.resolve(a.data):a.data.length?e.resolve(a.data[0]):e.reject(),e.promise}),e.promise}}}])}(),function(){"use strict";angular.module("ThaiHome").controller("UserCtrl",["$scope","Auth",function(a,b){a.credentials={email:"",password:""},a.login=function(){b.login(a.credentials)}}]).factory("User",["$http","CONFIG","$q","$rootScope","Token",function(a,b,c,d,e){return{getAll:function(d){var e=c.defer();return a.get(b.API_URL+"/users",{params:d}).then(function(a){e.resolve(a.data)})["catch"](function(a){e.reject(a)}),e.promise},add:function(d){var e=c.defer();return d.created=moment().unix(),d.lastContact=moment().unix(),a.post(b.API_URL+"/users",d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},update:function(d,e){var f=c.defer();return a.put(b.API_URL+"/users/"+d,e).then(function(a){f.resolve(a.data)})["catch"](function(a){f.reject(a)}),f.promise},"delete":function(d){var e=c.defer();return a["delete"](b.API_URL+"/users/"+d).then(function(a){e.resolve(a)})["catch"](function(a){e.reject(a)}),e.promise},getDetails:function(d,e){var f=c.defer();return d?a.get(b.API_URL+"/users/"+d).then(function(a){return _.isObject(a.data)&&a.data.id?f.resolve(a.data):a.data.length?f.resolve(a.data[0]):f.reject(),f.promise}):e?a.get(b.API_URL+"/users",{params:{email:e}}).then(function(a){_.isObject(a.data)&&a.data.id?f.resolve(a.data):a.data.length?f.resolve(a.data[0]):f.reject()}):f.reject(),f.promise},getOne:function(f,g,h){var i=c.defer();return a.get(b.API_URL+"/users",{params:{email:f}}).then(function(c){var f=e.genToken();if(c&&c.data&&c.data[0]){var j=c.data[0];g.phone&&(j.phone=g.phone),g.name&&(j.name=g.name),g.country&&(j.country=g.country),j.agent&&(j.agent=g.agent),a.put(b.API_URL+"/users/"+j.id,j),d.admin||localStorage.setItem("auth",f);var k=c.data[0];k.auth=f,a.put(b.API_URL+"/users/"+k.id,k).then(function(){h?i.resolve(c.data[0]):i.resolve(c.data[0].id)})["catch"](function(){i.resolve(!1)})}else if(g){var l={email:g.email,password:g.email,name:g.name,phone:g.phone,agent:g.agent?g.agent:"",username:g.email,created:moment().unix(),lastContact:moment().unix(),type:"tenant",auth:f};localStorage.setItem("auth",f),a.post(b.API_URL+"/users",l).then(function(a){h?i.resolve(a.data):i.resolve(a.data.id)})}else i.resolve(!1)})["catch"](function(a){i.reject(a)}),i.promise},autoLoginTenant:function(d){var e=c.defer();return a.post(b.API_URL+"/users/login",{username:d,password:d}).then(function(){e.resolve()})["catch"](function(){e.resolve()}),e.promise},userTypes:function(){return[{value:"tenant",text:"tenant"},{value:"agent",text:"agent"},{value:"admin",text:"admin/manager"},{value:"translator",text:"translator"}]}}}])}(),-1!=location.pathname.indexOf("/voucher-print")&&$(".page-loading").addClass("hide"),function(){"use strict";angular.module("ThaiHome").config(["$stateProvider",function(a){a.state("voucher",{url:"/voucher/:id/",title:"title_voucher",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/voucher/index.html")},controller:"VoucherCtrl",resolve:{BookingData:["Booking","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}}).state("voucher-print",{url:"/voucher-print/:id/",title:"title_voucher_print",css:"/css/style.css",templateProvider:function(a){return a.get("templates/thaihome/voucher/voucher-print.html")},controller:"VoucherCtrl",resolve:{BookingData:["Booking","$q","$stateParams",function(a,b,c){var d=b.defer();return a.getDetails(c.id).then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a,404)}),d.promise}]}})}]).controller("VoucherCtrl",["BookingData","Payment","Contact","Modal","gMaps","$scope","$http","CONFIG","$timeout",function(a,b,c,d,e,f,g,h,i){$(".page-loading").addClass("hide"),f.data=a.data,f.priceExtra=0,f.locationThis=window.location.href.replace(window.location.pathname,"")+"/",f.translation=a.data.translation,_.each(f.data.priceExtra,function(a){f.priceExtra+=parseInt(a.price)}),f.rules=function(){d.rules(f.translation)},f.cancellation=function(){d.cancellation()},f.downloadAsPdf=function(a){g.get(h.API_URL+"/pdf",{params:{url:$("#printedArea").find(".container").html()}}).success(function(a){var b="<a id='download' href='"+h.API_URL+"/assets/voucherPDF/"+a.filename+"' download='Voucher.pdf' target='_blank'></a>",c=angular.element(b);angular.element("#downloadAsPdf").after(c),i(function(){angular.element("#download")[0].click(),angular.element("#download").remove(),i(function(){g.post(h.API_URL+"/pdf",{filename:a.filename}).success(function(a){})},1e3)}),$(".page-loading").addClass("hide")})},f.addhttp=function(a){return/^(f|ht)tps?:\/\//i.test(a)||(a="http:"+a),a},f.print=function(){window.print()}}])}();